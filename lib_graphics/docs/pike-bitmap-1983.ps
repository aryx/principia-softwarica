%!PS
%%Version: 3.3.2
%%DocumentFonts: (atend)
%%Pages: (atend)
%%EndComments
%
% Version 3.3.2 prologue for troff files.
%

/#copies 1 store
/aspectratio 1 def
/formsperpage 1 def
/landscape false def
/linewidth .3 def
/magnification 1 def
/margin 0 def
/orientation 0 def
/resolution 720 def
/rotation 1 def
/xoffset 0 def
/yoffset 0 def

/roundpage true def
/useclippath true def
/pagebbox [0 0 612 792] def

/R  /Times-Roman def
/I  /Times-Italic def
/B  /Times-Bold def
/BI /Times-BoldItalic def
/H  /Helvetica def
/HI /Helvetica-Oblique def
/HB /Helvetica-Bold def
/HX /Helvetica-BoldOblique def
/CW /Courier def
/CO /Courier def
/CI /Courier-Oblique def
/CB /Courier-Bold def
/CX /Courier-BoldOblique def
/PA /Palatino-Roman def
/PI /Palatino-Italic def
/PB /Palatino-Bold def
/PX /Palatino-BoldItalic def
/Hr /Helvetica-Narrow def
/Hi /Helvetica-Narrow-Oblique def
/Hb /Helvetica-Narrow-Bold def
/Hx /Helvetica-Narrow-BoldOblique def
/KR /Bookman-Light def
/KI /Bookman-LightItalic def
/KB /Bookman-Demi def
/KX /Bookman-DemiItalic def
/AR /AvantGarde-Book def
/AI /AvantGarde-BookOblique def
/AB /AvantGarde-Demi def
/AX /AvantGarde-DemiOblique def
/NR /NewCenturySchlbk-Roman def
/NI /NewCenturySchlbk-Italic def
/NB /NewCenturySchlbk-Bold def
/NX /NewCenturySchlbk-BoldItalic def
/ZD /ZapfDingbats def
/ZI /ZapfChancery-MediumItalic def
/S  /S def
/S1 /S1 def
/GR /Symbol def

/inch {72 mul} bind def
/min {2 copy gt {exch} if pop} bind def

/show {{//show} 0 get exec} bind def	% so later references don't bind
/widthshow {{//widthshow} 0 get exec} bind def
/stringwidth {{//stringwidth} 0 get exec} bind def

/setup {
	counttomark 2 idiv {def} repeat pop

	landscape {/orientation 90 orientation add def} if
	/scaling 72 resolution div def
	linewidth setlinewidth
	1 setlinecap

	pagedimensions
	xcenter ycenter translate
	orientation rotation mul rotate
	width 2 div neg height 2 div translate
	xoffset inch yoffset inch neg translate
	margin 2 div dup neg translate
	magnification dup aspectratio mul scale
	scaling scaling scale

	addmetrics
	0 0 moveto
} def

/pagedimensions {
	useclippath userdict /gotpagebbox known not and {
		/pagebbox [clippath pathbbox newpath] def
		roundpage currentdict /roundpagebbox known and {roundpagebbox} if
	} if
	pagebbox aload pop
	4 -1 roll exch 4 1 roll 4 copy
	landscape {4 2 roll} if
	sub /width exch def
	sub /height exch def
	add 2 div /xcenter exch def
	add 2 div /ycenter exch def
	userdict /gotpagebbox true put
} def

/addmetrics {
	/Symbol /S null Sdefs cf
	/Times-Roman /S1 StandardEncoding dup length array copy S1defs cf
} def

/pagesetup {
	/page exch def
	currentdict /pagedict known currentdict page known and {
		page load pagedict exch get cvx exec
	} if
} def

/decodingdefs [
	{counttomark 2 idiv {y moveto show} repeat}
	{neg /y exch def counttomark 2 idiv {y moveto show} repeat}
	{neg moveto {2 index stringwidth pop sub exch div 0 32 4 -1 roll widthshow} repeat}
	{neg moveto {spacewidth sub 0.0 32 4 -1 roll widthshow} repeat}
	{counttomark 2 idiv {y moveto show} repeat}
	{neg setfunnytext}
] def

/setdecoding {/t decodingdefs 3 -1 roll get bind def} bind def

/w {neg moveto show} bind def
/m {neg dup /y exch def moveto} bind def
/done {/lastpage where {pop lastpage} if} def

/f {
	dup /font exch def findfont exch
	dup /ptsize exch def scaling div dup /size exch def scalefont setfont
	linewidth ptsize mul scaling 10 mul div setlinewidth
	/spacewidth ( ) stringwidth pop def
} bind def

/changefont {
	/fontheight exch def
	/fontslant exch def
	currentfont [
		1 0
		fontheight ptsize div fontslant sin mul fontslant cos div
		fontheight ptsize div
		0 0
	] makefont setfont
} bind def

/sf {f} bind def

/cf {
	dup length 2 idiv
	/entries exch def
	/chtab exch def
	/newencoding exch def
	/newfont exch def

	findfont dup length 1 add dict
	/newdict exch def
	{1 index /FID ne {newdict 3 1 roll put}{pop pop} ifelse} forall

	newencoding type /arraytype eq {newdict /Encoding newencoding put} if

	newdict /Metrics entries dict put
	newdict /Metrics get
	begin
		chtab aload pop
		1 1 entries {pop def} for
		newfont newdict definefont pop
	end
} bind def

%
% A few arrays used to adjust reference points and character widths in some
% of the printer resident fonts. If square roots are too high try changing
% the lines describing /radical and /radicalex to,
%
%	/radical	[0 -75 550 0]
%	/radicalex	[-50 -75 500 0]
%
% Move braceleftbt a bit - default PostScript character is off a bit.
%

/Sdefs [
	/bracketlefttp		[201 500]
	/bracketleftbt		[201 500]
	/bracketrighttp		[-81 380]
	/bracketrightbt		[-83 380]
	/braceleftbt		[203 490]
	/bracketrightex		[220 -125 500 0]
	/radical		[0 0 550 0]
	/radicalex		[-50 0 500 0]
	/parenleftex		[-20 -170 0 0]
	/integral		[100 -50 500 0]
	/infinity		[10 -75 730 0]
] def

/S1defs [
	/underscore		[0 80 500 0]
	/endash			[7 90 650 0]
] def
%
% Tries to round clipping path dimensions, as stored in array pagebbox, so they
% match one of the known sizes in the papersizes array. Lower left coordinates
% are always set to 0.
%

/roundpagebbox {
    7 dict begin
	/papersizes [8.5 inch 11 inch 14 inch 17 inch] def

	/mappapersize {
		/val exch def
		/slop .5 inch def
		/diff slop def
		/j 0 def
		0 1 papersizes length 1 sub {
			/i exch def
			papersizes i get val sub abs
			dup diff le {/diff exch def /j i def} {pop} ifelse
		} for
		diff slop lt {papersizes j get} {val} ifelse
	} def

	pagebbox 0 0 put
	pagebbox 1 0 put
	pagebbox dup 2 get mappapersize 2 exch put
	pagebbox dup 3 get mappapersize 3 exch put
    end
} bind def

%%EndProlog
%%BeginSetup
mark
/linewidth 0.5 def
/#copies 1 store
/landscape false def
/resolution 720 def
setup
2 setdecoding
%%EndSetup
%%Page: 0 1
/saveobj save def
mark
1 pagesetup
10 PA f
(AT&T Bell Laboratories)2 1053 1 2353 1740 t
(Murray Hill, New Jersey 07974)4 1367 1 2196 1860 t
(Computing Science Technical Report No. 999)5 1996 1 1882 3180 t
12 PB f
(Graphics in Overlapping Bitmap Layers)4 2192 1 1784 3450 t
10 PI f
(Rob Pike)1 354 1 2703 3690 t
10 PA f
(April 1, 1983)2 561 1 720 6240 t
cleartomark
showpage
saveobj restore
%%EndPage: 0 1
%%Page: 0 2
/saveobj save def
mark
2 pagesetup
12 PB f
(Graphics in Overlapping Bitmap Layers)4 2192 1 1784 1230 t
10 PI f
(Rob Pike)1 354 1 2703 1470 t
10 PA f
(AT&T Bell Laboratories)2 1053 1 2353 1650 t
(Murray Hill, New Jersey 07974)4 1367 1 2196 1770 t
10 PI f
(ABSTRACT)2621 2270 w
10 PA f
( store multiple program-)3 1109(One of the common uses of bitmap terminals is to)9 2241 2 1330 2530 t
( the screen called win-)4 1019(ming contexts in multiple, possibly overlapping, areas of)7 2581 2 1080 2650 t
( a programming environ-)3 1152( traditionally store the visible state of)6 1695(dows. Windows)1 753 3 1080 2770 t
( or debugger, while the user works with some other pro-)10 2554(ment, such as an editor)4 1046 2 1080 2890 t
( model of interaction is attractive for one-process systems, but to)10 3078(gram. This)1 522 2 1080 3010 t
( be asyn-)2 438(make full use of a multiprogramming environment, windows must)8 3162 2 1080 3130 t
( windows.)1 465(chronously updated, even when partially or wholly obscured by other)9 3135 2 1080 3250 t
( in one window, displaying messages)5 1703(For example, a long compilation may run)6 1897 2 1080 3370 t
(as appropriate, while the user edits a file in another window.)10 2693 1 1080 3490 t
( graphics primitives to manipu-)4 1435(This document describes a set of low-level)6 1915 2 1330 3646 t
(late overlapping asynchronous windows, called)4 2160 1 1080 3766 t
10 I f
(layers)3276 3766 w
10 PA f
( a bitmap display ter-)4 986(, on)1 174 2 3520 3766 t
( previous window software such as [mey81] and [tes81], these)9 2950(minal. Unlike)1 650 2 1080 3886 t
( bitmap operator)2 786(primitives extend the domain of the general)6 2066 2 1080 4006 t
10 PI f
(bitblt)3977 4006 w
10 PA f
([gui82] to)1 444 1 4236 4006 t
(include bitmaps which are partially or wholly obscured.)7 2482 1 1080 4126 t
(April 1, 1983)2 561 1 720 4606 t
cleartomark
showpage
saveobj restore
%%EndPage: 0 2
%%Page: 1 3
/saveobj save def
mark
3 pagesetup
12 PB f
(Graphics in Overlapping Bitmap Layers)4 2192 1 1784 1230 t
10 PI f
(Rob Pike)1 354 1 2703 1470 t
10 PA f
(AT&T Bell Laboratories)2 1053 1 2353 1650 t
(Murray Hill, New Jersey 07974)4 1367 1 2196 1770 t
( Graphics]: Picture/Image Generation;)3 1760(CR Categories and Subject Descriptors: I.3.3 [Computer)6 2560 2 720 2286 t
(I.3.4 [Computer Graphics]: Graphics Utilities.)4 2003 1 720 2406 t
(General Terms: Algorithms)2 1211 1 720 2646 t
(Additional Key Words and Phrases: Raster image, bitmaps, bitblt instruction, windows.)10 3876 1 720 2886 t
10 PB f
(Introduction)720 3126 w
10 PA f
( their drawbacks, they are sufficiently inexpensive to)7 2353( Despite)1 390(Bitmap displays are in vogue.)4 1327 3 970 3282 t
( although)1 435( Unfortunately,)1 717( computer center resources.)3 1251(be personal equipment rather than shared)5 1917 4 720 3402 t
(their use has become widespread, most bitmap displays are controlled by primitive software.)12 4117 1 720 3522 t
( a set of rectangular areas called)6 1428(Bitmap screens are commonly divided into)5 1909 2 970 3678 t
10 PI f
(windows)4335 3678 w
10 PA f
(each of)1 316 1 4724 3678 t
( application.)1 555(which maintains the input and output context for a particular program or graphics)12 3765 2 720 3798 t
( display can become several screens at once \320 different windows can be emulating)13 3886(A bitmap)1 434 2 720 3918 t
( screen areas)2 582( The)1 228( tables or even arcade games.)5 1344(standard terminals, graphics terminals, drafting)4 2166 4 720 4038 t
( areas of two programs may overlap, with one area fully visible)11 2810(need not be disjoint \320 the display)6 1510 2 720 4158 t
( manipulate these)2 806( paper describes software to)4 1287( This)1 252(and the other partially or wholly obscured.)6 1975 4 720 4278 t
(overlapping windows, or)2 1138 1 720 4398 t
10 I f
(layers)1891 4398 w
10 PA f
( program drawing in a layer is fully iso-)8 1835( A)1 136(, on a single display.)4 934 3 2135 4398 t
( even if one layer overlaps, and thereby)7 1792(lated from other programs drawing on the same screen,)8 2528 2 720 4518 t
( operators to work with layers, which)6 1702( extending the basic bitmap)4 1241( By)1 173(obscures part of, the other.)4 1204 4 720 4638 t
( its layer)2 389(may be regarded as possibly obscured, subdivided bitmaps, each program manipulates)10 3931 2 720 4758 t
( other bitmap in a more conventional environ-)7 2098(just as it would manipulate the full screen or any)9 2222 2 720 4878 t
( removed from considerations regarding, for example, which layers)8 3208( program is)2 568(ment. Each)1 544 3 720 4998 t
( programs may \(almost\) simultaneously draw in their respective layers,)9 3240(obscure which, and two)3 1080 2 720 5118 t
(even though some of the drawn objects are currently obscured from view.)11 3265 1 720 5238 t
10 PB f
(Comparison with previous work)3 1485 1 720 5478 t
10 PA f
( mey81,)1 366(A number of window systems have been implemented by others [lan79, tes81,)11 3704 2 970 5634 t
( some distinguishing characteristics, dictated largely)5 2351(wei81], but the software presented here has)6 1969 2 720 5754 t
( connected to a)3 689( environment is a bitmap display)5 1499( The)1 225(by the environment under which it is run.)7 1907 4 720 5874 t
( a limited but useful amount of off-screen memory)8 2316(multiprogrammed timesharing system, with)3 2004 2 720 5994 t
( the system is multiprogrammed, any program)6 2138( Because)1 413(\(about a screenful\) for storing bitmaps.)5 1769 3 720 6114 t
( attached to the keyboard)4 1137(may want to update its window at any time, regardless of whether it is)13 3183 2 720 6234 t
( the user program be)4 1001( is also important that)4 1043( It)1 136(and mouse or even whether it is fully visible.)8 2140 4 720 6354 t
( changes in the window configuration should be)7 2190(removed from concerns about window update:)5 2130 2 720 6474 t
( precludes the simple ``repaint'' mechanism, wherein a program is)9 2971( This)1 245( program.)1 444(invisible to the)2 660 4 720 6594 t
( redraw its window whenever its visibility changes, because repainting forces the)11 3744(instructed to)1 576 2 720 6714 t
( the file system, which)4 1020( Like)1 253( software.)1 443(user program to deal with issues better left to lower-level)9 2604 4 720 6834 t
( be scat-)2 365(makes a user file look like a contiguously addressable stream of bytes although it might)14 3955 2 720 6954 t
( should provide a simple programming interface so a)8 2438(tered across the disk, the window system)6 1882 2 720 7074 t
( it is a contiguous bitmap, regardless of its)8 1959(program can always draw in its window as though)8 2361 2 720 7194 t
(position or visibilty on the screen.)5 1496 1 720 7314 t
cleartomark
showpage
saveobj restore
%%EndPage: 1 3
%%Page: 2 4
/saveobj save def
mark
4 pagesetup
10 PA f
(- 2 -)2 166 1 2797 480 t
( first, exemplified by)3 952( The)1 230( providing this transparency.)3 1324(There are two basic approaches to)5 1564 4 970 840 t
( re-evaluated when the window)4 1427(the BRUWIN system [mey81], is to maintain a display list that is)11 2893 2 720 960 t
( mem-)1 292( this method typically uses a relatively small amount of)9 2527( Although)1 486(configuration changes.)1 1015 4 720 1080 t
( on the dis-)3 501(ory to hold the display list, and makes it easy to rearrange the layout of the windows)16 3819 2 720 1200 t
( a freshly uncovered portion)4 1264( problem is that the time to redraw)7 1549( One)1 236(play, it has a few difficulties.)5 1271 4 720 1320 t
( important, it is only possible)5 1292( More)1 289(of a window is substantial if the window's display list is long.)11 2739 3 720 1440 t
( for example, only supports characters, con-)6 1968( BRUWIN,)1 504( can encode.)2 553(to draw what the display list)5 1295 4 720 1560 t
( primitives to the dis-)4 962( adding bitmap)2 690( Even)1 278(tradicting the generality of the bitmap data structure.)7 2390 4 720 1680 t
( using a bitmap paint program to create a)8 1862( Consider)1 458( however.)1 442(play list is not entirely satisfactory,)5 1558 4 720 1800 t
( display list to)3 701(realistic scene: the bitmap containing the scene is probably smaller than the)11 3619 2 720 1920 t
( introduce an)2 602( lists)1 207( Display)1 400(describe it, and certainly takes much less time to draw on the screen.)12 3111 4 720 2040 t
(unnecessary level of indirection.)3 1428 1 720 2160 t
( is to keep the window image in a)8 1567(The second method, used on the Lisp Machine [wei81],)8 2503 2 970 2316 t
(contiguous off-screen bitmap and copy data from there to the visible portions of the on-screen)14 4320 1 720 2436 t
( but takes a)3 511( simple method has the advantage of supporting any bitmap operation,)10 3173(window. This)1 636 3 720 2556 t
( memory and can be inefficient \320 it may be necessary to exe-)12 2769(constant large amount of auxiliary)4 1551 2 720 2676 t
(cute each bitmap operation twice: once off-screen and once on-screen.)9 3079 1 720 2796 t
( By)1 172( of this ``shadow bitmap'' method.)5 1544(The layers software is in some sense an optimization)8 2354 3 970 2952 t
(dividing the windows into visible and obscured parts, and only keeping obscured parts off-)13 4320 1 720 3072 t
( no display lists\) by letting the screen)7 1730(screen, it uses the minimum memory possible \(assuming)7 2590 2 720 3192 t
( bitmap)1 340( basic idea is to extend the domain of the general)10 2163( The)1 218(memory itself hold the visible parts.)5 1599 4 720 3312 t
(operator)720 3432 w
10 PI f
(bitblt)1132 3432 w
10 PA f
( drawing)1 409( Layer)1 312( obscured.)1 462([gui82] to include windows that are wholly or partially)8 2480 4 1377 3432 t
( although the num-)3 867(operations therefore touch the same number of pixels regardless of visibility,)10 3453 2 720 3552 t
( data)1 222( The)1 220( may be larger if there are on-screen and off-screen components.)10 2862(ber of bitblt operations)3 1016 4 720 3672 t
(structures and software are designed to make drawing in a layer as fast as possible, at the)16 4320 1 720 3792 t
( and deletion are still fast\).)5 1216(expense of slower creation and deletion operators \(although creation)8 3104 2 720 3912 t
( operator, making a layer fully visible, is also efficient because it)11 2822(The most common layer shuffling)4 1498 2 720 4032 t
( are disadvantages, of course: the data)6 1732( There)1 313( those pixels that need to be updated.)7 1705(touches only)1 570 4 720 4152 t
( more than about a dozen overlapping layers, and translating a)10 2823(structures become unwieldy with)3 1497 2 720 4272 t
( but the software has been implemented and works comfortably)9 2855(layer across the screen is clumsy,)5 1465 2 720 4392 t
( and their average)3 836(in our time-sharing environment, where the number of layers is fairly small)11 3484 2 720 4512 t
(lifetime long.)1 585 1 720 4632 t
10 PB f
(Definitions)720 4872 w
10 PA f
( described herein, written in a pseudo-C dialect, use several simple defined)11 3437(The programs)1 633 2 970 5028 t
( for bitmap oper-)3 754( section describes the basic concepts)5 1591( This)1 241(types and primitive bitmap operations.)4 1734 4 720 5148 t
( next section defines bitmaps precisely.)5 1722( The)1 217(ations, but does not attempt to be complete.)7 1933 3 720 5268 t
(A Point is an ordered pair)5 1149 1 970 5424 t
10 CW f
(typedef struct{)1 900 1 1080 5604 t
(int x, y;)2 540 1 1330 5724 t
(}Point;)1080 5844 w
10 PA f
( Rectangle is defined by a pair of Points)8 1795( A)1 134( as the screen.)3 629(that defines a location in a bitmap such)7 1762 4 720 6024 t
(spanning a diagonal:)2 924 1 720 6144 t
10 CW f
(typedef struct{)1 900 1 1080 6324 t
( min x,y */)3 660( /*)1 340(Point origin;)1 780 3 1330 6444 t
( max x,y */)3 660( /*)1 340(Point corner;)1 780 3 1330 6564 t
(}Rectangle;)1080 6684 w
10 PA f
(By definition,)1 607 1 720 6864 t
10 CW f
(corner.x)1359 6864 w
10 S f
(\263)1871 6864 w
10 CW f
(origin.x)1958 6864 w
10 PA f
(and)2470 6864 w
10 CW f
(corner.y)2671 6864 w
10 S f
(\263)3183 6864 w
10 CW f
(origin.y)3270 6864 w
10 PA f
( are half-open: a)3 733(. Rectangles)1 557 2 3750 6864 t
( through)1 401(Rectangle contains the horizontal and vertical lines)6 2354 2 720 6984 t
10 CW f
(origin)3516 6984 w
10 PA f
(, and abuts, but does not)5 1164 1 3876 6984 t
(contain, the lines through)3 1396 1 720 7104 t
10 CW f
(corner)2229 7104 w
10 PA f
( abutting rectangles)2 1050(. Two)1 362 2 2589 7104 t
10 PI f
(r)4115 7104 w
7 PA f
(0)4165 7124 w
10 PA f
(and)4322 7104 w
10 PI f
(r)4605 7104 w
7 PA f
(1)4655 7124 w
10 PA f
(, with)1 342 1 4698 7104 t
10 PI f
(r)720 7224 w
7 PA f
(1)770 7244 w
10 CW f
(.origin = \()2 572 1 813 7224 t
10 PI f
(r)1385 7224 w
7 PA f
(0)1435 7244 w
10 CW f
(.corner.x)1478 7224 w
10 PA f
(,)2018 7224 w
10 PI f
(r)2087 7224 w
7 PA f
(0)2137 7244 w
10 CW f
(.origin.y\))2180 7224 w
10 PA f
( same)1 272( The)1 236(, therefore have no point in common.)6 1752 3 2780 7224 t
cleartomark
showpage
saveobj restore
%%EndPage: 2 4
%%Page: 3 5
/saveobj save def
mark
5 pagesetup
10 PA f
(- 3 -)2 166 1 2797 480 t
( lines in any direction: a line segment drawn from \()10 2327(applies to)1 437 2 720 840 t
10 PI f
(x)3492 840 w
7 PA f
(0)3553 860 w
10 PA f
(,)3604 840 w
10 PI f
(y)3637 840 w
7 PA f
(0)3698 860 w
10 PA f
(\) to \()2 218 1 3749 840 t
10 PI f
(x)3975 840 w
7 PA f
(1)4036 860 w
10 PA f
(,)4087 840 w
10 PI f
(y)4120 840 w
7 PA f
(1)4181 860 w
10 PA f
(\) does not contain)3 808 1 4232 840 t
(\()720 960 w
10 PI f
(x)761 960 w
7 PA f
(1)822 980 w
10 PA f
(,)873 960 w
10 PI f
(y)906 960 w
7 PA f
(1)967 980 w
10 PA f
( which is essential to the)5 1139( curious definitions simplify drawing objects in pieces,)7 2504(\). These)1 379 3 1018 960 t
(layer primitives.)1 727 1 720 1080 t
(The routine)1 520 1 970 1236 t
10 CW f
(rectf\(b, r, f\))2 780 1 1520 1236 t
10 PA f
(performs a function specified by an integer code)7 2169 1 2330 1236 t
10 CW f
(f)4529 1236 w
10 PA f
( rect-)1 229(, in a)2 222 2 4589 1236 t
(angle)720 1356 w
10 CW f
(r)986 1356 w
10 PA f
(, in a bitmap)3 552 1 1046 1356 t
10 CW f
(b)1623 1356 w
10 PA f
( function code is one of:)5 1048(. The)1 242 2 1683 1356 t
10 CW f
(CLR:)1080 1536 w
10 PA f
(clear rectangle to zeros)3 1015 1 1830 1536 t
10 CW f
(OR:)1080 1656 w
10 PA f
(set rectangle to ones)3 895 1 1830 1656 t
10 CW f
(XOR:)1080 1776 w
10 PA f
(invert bits in rectangle)3 991 1 1830 1776 t
(The routine)1 520 1 720 1956 t
10 CW f
(bitblt\(sb, r, db, p, f\))4 1264 1 1270 1956 t
10 PA f
(\(bit-block transfer\) copies a source Rectangle)5 2004 1 2565 1956 t
10 CW f
(r)4600 1956 w
10 PA f
(in a bit-)2 349 1 4691 1956 t
(map)720 2076 w
10 CW f
(sb)951 2076 w
10 PA f
(to a corresponding Rectangle with)4 1552 1 1104 2076 t
10 CW f
(origin p)1 453 1 2689 2076 t
10 PA f
(in a destination bitmap)3 1047 1 3175 2076 t
10 CW f
(db)4255 2076 w
10 PA f
(.)4375 2076 w
10 CW f
(bitblt\(\))4457 2076 w
10 PA f
(is)4969 2076 w
( the function code)3 795(therefore a form of Rectangle assignment operator, and)7 2444 2 720 2196 t
10 CW f
(f)3985 2196 w
10 PA f
(specifies the nature of)3 969 1 4071 2196 t
(the assignment:)1 693 1 720 2316 t
10 CW f
( source)1 480( =)1 120(STORE: dest)1 1240 3 1080 2496 t
( |= source)2 600(OR: dest)1 990 2 1080 2616 t
( &= \304source)2 660(CLR: dest)1 990 2 1080 2736 t
( \303= source)2 600(XOR: dest)1 990 2 1080 2856 t
10 PA f
(For example,)1 588 1 720 3036 t
10 CW f
(OR)1345 3036 w
10 PA f
( the)1 177(specifies that the destination Rectangle is formed from the bit-wise OR of)11 3361 2 1502 3036 t
(source and destination Rectangles before the)5 1987 1 720 3156 t
10 CW f
(bitblt\(\))2735 3156 w
10 PA f
(. Here,)1 321 1 3215 3156 t
10 CW f
(|)3563 3156 w
10 PA f
(,)3623 3156 w
10 CW f
(&)3675 3156 w
10 PA f
(,)3735 3156 w
10 CW f
(\303)3787 3156 w
10 PA f
(and)3874 3156 w
10 CW f
(\304)4070 3156 w
10 PA f
(are C's bit-wise OR,)3 883 1 4157 3156 t
(AND, exclusive-OR and NOT operators, and the notation)7 2579 1 720 3276 t
10 CW f
(x *= y)2 372 1 3329 3276 t
10 PA f
(is equivalent to)2 688 1 3732 3276 t
10 CW f
(x = x * y)4 564 1 4451 3276 t
10 PA f
(,)5015 3276 w
(but is notationally and semantically closer to the machine.)8 2564 1 720 3396 t
(Often,)970 3552 w
10 CW f
(bitblt\(\))1279 3552 w
10 PA f
( permit stippling)2 762(is defined to copy through a two-dimensional mask, to)8 2486 2 1792 3552 t
( original)1 372( Our)1 230( operations.)1 521(and related)1 505 4 720 3672 t
10 CW f
(bitblt\(\))2374 3672 w
10 PA f
(had implementation problems \(which have since)5 2160 1 2880 3672 t
(been resolved\) which forced us to not incorporate a mask into the primitive; for compatibility,)14 4320 1 720 3792 t
(our current)1 512 1 720 3912 t
10 CW f
(bitblt\(\))1266 3912 w
10 PA f
( whether a mask is present has no)7 1548( However,)1 496(also does not have a mask.)5 1216 3 1780 3912 t
(bearing on the ideas presented here.)5 1600 1 720 4032 t
10 CW f
(bitblt\(\))970 4188 w
10 PA f
( used to draw characters, save screen)6 1711( is)1 108( It)1 129(is a fundamental bitmap operation.)4 1605 4 1487 4188 t
( with a bit mask, it includes)6 1274( Defined)1 414(rectangles and present menus.)3 1372 3 720 4308 t
10 CW f
(rectf\(\).)3815 4308 w
10 PA f
( thorough)1 449(For a)1 236 2 4355 4308 t
(description, see [ing81] or [gui82].)4 1550 1 720 4428 t
10 CW f
(bitblt\(\))2332 4428 w
10 PA f
( In)1 155( operation, however.)2 942(can be a very expensive)4 1094 3 2849 4428 t
( masked)1 389(the general case, the data from the source Rectangle must be shifted or rotated and)14 3931 2 720 4548 t
( amount of data processed in a single)7 1710(before being written to the destination Rectangle, and the)8 2610 2 720 4668 t
10 CW f
(bitblt\(\))720 4788 w
10 PA f
(can be surprisingly large.)3 1119 1 1225 4788 t
10 PB f
(Bitmaps)720 5028 w
10 PA f
( details of the represen-)4 1044( The)1 219( image.)1 323(A bitmap is a dot-matrix representation of a rectangular)8 2484 4 970 5184 t
( hardware, or, more specifically, on the arrangement of memory in)10 3015(tation depend on the display)4 1305 2 720 5304 t
( the software in the display, the screen)7 1772( the idea of a bitmap to mesh well with)9 1811( For)1 211(the display.)1 526 4 720 5424 t
( as a bitmap with no special properties other than its visibility.)11 2985(must appear to the program)4 1335 2 720 5544 t
( the same format)3 759(Because images \(bitmaps\) are stored off-screen, off-screen memory should have)9 3561 2 720 5664 t
( screen itself, so that copying images to and from the screen is not a special case in the soft-)19 4060(as the)1 260 2 720 5784 t
( way to achieve this generality is to make the screen a contiguous array of)14 3437( simplest)1 408(ware. The)1 475 3 720 5904 t
( by the first word of the next scan)8 1478(memory, with the last word in a scan line followed immediately)10 2842 2 720 6024 t
( to the programmer: a two-)5 1376( this scheme, bitmaps become something familiar)6 2385(line. Under)1 559 3 720 6144 t
(dimensional array.)1 833 1 720 6264 t
( which to store the actual image, some auxiliary informa-)9 2563(Given a two-dimensional array in)4 1507 2 970 6420 t
( The)1 240( 1 illustrates how a bitmap is interpreted.)7 1976( Figure)1 362( its interpretation.)2 839(tion is required for)3 903 5 720 6540 t
( the allocation routine,)3 1027( a bitmap is allocated,)4 1000( When)1 324(hatched region is the location of the image.)7 1969 4 720 6660 t
10 CW f
(balloc\(\))720 6780 w
10 PA f
( of one)2 329(, assumes its data will correspond to a screen rectangle, for example, a part)13 3511 2 1200 6780 t
(layer obscured by another.)3 1199 1 720 6900 t
10 CW f
(balloc\(\))1975 6900 w
10 PA f
( right margins of the bitmap to word-)7 1705(creates the left and)3 849 2 2486 6900 t
( word boundaries in the bitmap are at the same relative posi-)11 2726(align the bitmap with the screen, so)6 1594 2 720 7020 t
( technique can make a significant performance difference for the com-)10 3122( This)1 244( the screen.)2 502(tions as in)2 452 4 720 7140 t
(mon operation of saving and restoring screen rectangles.)7 2506 1 720 7260 t
cleartomark
showpage
saveobj restore
%%EndPage: 3 5
%%Page: 4 6
/saveobj save def
mark
6 pagesetup
10 PA f
(- 4 -)2 166 1 2797 480 t
10 CW f
(word bdry)1 540 1 4019 3175 t
cleartomark
saveobj restore
%%BeginGlobal
%
% Version 3.3.2 drawing procedures for dpost. Automatically pulled in when
% needed.
%

/inpath false def
/savematrix matrix def

/Dl {
	inpath
		{pop pop neg lineto}
		{newpath neg moveto neg lineto stroke}
	ifelse
} bind def

/De {
	/y1 exch 2 div def
	/x1 exch 2 div def
	/savematrix savematrix currentmatrix def
	neg exch x1 add exch translate
	x1 y1 scale
	0 0 1 0 360
	inpath
		{1 0 moveto arc savematrix setmatrix}
		{newpath arc savematrix setmatrix stroke}
	ifelse
} bind def

/Da {
	/dy2 exch def
	/dx2 exch def
	/dy1 exch def
	/dx1 exch def
	dy1 add neg exch dx1 add exch
	dx1 dx1 mul dy1 dy1 mul add sqrt
	dy1 dx1 neg atan
	dy2 neg dx2 atan
	inpath
		{arc}
		{newpath arc stroke}
	ifelse
} bind def

/DA {
	/dy2 exch def
	/dx2 exch def
	/dy1 exch def
	/dx1 exch def
	dy1 add neg exch dx1 add exch
	dx1 dx1 mul dy1 dy1 mul add sqrt
	dy1 dx1 neg atan
	dy2 neg dx2 atan
	inpath
		{arcn}
		{newpath arcn stroke}
	ifelse
} bind def

/Ds {
	/y2 exch def
	/x2 exch def
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	x0 5 x1 mul add 6 div
	y0 5 y1 mul add -6 div
	x2 5 x1 mul add 6 div
	y2 5 y1 mul add -6 div
	x1 x2 add 2 div
	y1 y2 add -2 div
	inpath
		{curveto}
		{newpath x0 x1 add 2 div y0 y1 add -2 div moveto curveto stroke}
	ifelse
} bind def
%%EndGlobal
/saveobj save def
mark
10 CW f
4319 2883 4289 2819 Dl
4289 2820 4259 2884 Dl
4289 2997 4289 2819 Dl
(word bdry)1 540 1 1526 3175 t
1826 2883 1796 2819 Dl
1796 2820 1766 2884 Dl
1796 2997 1796 2819 Dl
(bitsPerWord*width)2533 960 w
(height)1208 1964 w
(rect.origin)922 2890 w
1903 2677 1938 2677 Dl
1938 2677 1903 2719 Dl
1583 2890 1618 2869 Dl
1618 2869 1760 2763 Dl
1760 2763 1760 2804 Dl
1761 2804 1903 2698 Dl
1903 2698 1938 2677 Dl
(base)1200 2463 w
1761 2635 1796 2677 Dl
1795 2676 1760 2676 Dl
1440 2463 1475 2484 Dl
1476 2485 1618 2549 Dl
1618 2549 1618 2590 Dl
1618 2591 1760 2655 Dl
1761 2656 1796 2677 Dl
3043 1031 3043 1031 3043 1060 Ds
3043 1031 3043 1060 3292 1119 Ds
3043 1060 3292 1119 4040 1119 Ds
3292 1119 4040 1119 4289 1148 Ds
4040 1119 4289 1148 4289 1177 Ds
4289 1148 4289 1177 4289 1177 Ds
3043 1031 3043 1031 3043 1060 Ds
3043 1031 3043 1060 2794 1119 Ds
3043 1060 2794 1119 2046 1119 Ds
2794 1119 2046 1119 1797 1148 Ds
2046 1119 1797 1148 1797 1177 Ds
1797 1148 1797 1177 1797 1177 Ds
1639 1964 1639 1964 1656 1964 Ds
1639 1964 1656 1964 1690 1822 Ds
1656 1964 1690 1822 1690 1395 Ds
1690 1822 1690 1395 1707 1253 Ds
1690 1395 1707 1253 1724 1253 Ds
1707 1253 1724 1253 1724 1253 Ds
1639 1964 1639 1964 1656 1964 Ds
1639 1964 1656 1964 1690 2106 Ds
1656 1964 1690 2106 1690 2533 Ds
1690 2106 1690 2533 1707 2675 Ds
1690 2533 1707 2675 1724 2675 Ds
1707 2675 1724 2675 1724 2675 Ds
10 S1 f
(_ _________________________________________________)1 2493 1 1796 1252 t
10 S f
(\347)1796 2677 w
(\347)1796 2653 w
(\347)1796 2553 w
(\347)1796 2453 w
(\347)1796 2353 w
(\347)1796 2253 w
(\347)1796 2153 w
(\347)1796 2053 w
(\347)1796 1953 w
(\347)1796 1853 w
(\347)1796 1753 w
(\347)1796 1653 w
(\347)1796 1553 w
(\347)1796 1453 w
(\347)1796 1353 w
10 S1 f
(_ _________________________________________________)1 2493 1 1796 2677 t
10 S f
(\347)4289 1352 w
(\347)4289 1376 w
(\347)4289 1476 w
(\347)4289 1576 w
(\347)4289 1676 w
(\347)4289 1776 w
(\347)4289 1876 w
(\347)4289 1976 w
(\347)4289 2076 w
(\347)4289 2176 w
(\347)4289 2276 w
(\347)4289 2376 w
(\347)4289 2476 w
(\347)4289 2576 w
(\347)4289 2676 w
10 S1 f
(_ __________________________________________)1 2137 1 1938 1252 t
10 S f
(\347)1938 2677 w
(\347)1938 2653 w
(\347)1938 2553 w
(\347)1938 2453 w
(\347)1938 2353 w
(\347)1938 2253 w
(\347)1938 2153 w
(\347)1938 2053 w
(\347)1938 1953 w
(\347)1938 1853 w
(\347)1938 1753 w
(\347)1938 1653 w
(\347)1938 1553 w
(\347)1938 1453 w
(\347)1938 1353 w
10 S1 f
(_ __________________________________________)1 2137 1 1939 2677 t
10 S f
(\347)4076 1352 w
(\347)4076 1376 w
(\347)4076 1476 w
(\347)4076 1576 w
(\347)4076 1676 w
(\347)4076 1776 w
(\347)4076 1876 w
(\347)4076 1976 w
(\347)4076 2076 w
(\347)4076 2176 w
(\347)4076 2276 w
(\347)4076 2376 w
(\347)4076 2476 w
(\347)4076 2576 w
(\347)4076 2676 w
3974 2677 4076 2629 Dl
3261 2676 4076 2296 Dl
2549 2676 4076 1964 Dl
1939 2628 4076 1632 Dl
1939 2296 4076 1300 Dl
1939 1964 3466 1252 Dl
1939 1632 2754 1252 Dl
1939 1300 2041 1252 Dl
8 PA f
( storage begins and ends on word boundaries, with the last word of one)13 2650( The)1 182( of a bitmap.)3 468( Layout)1 301(Figure 1.)1 319 5 1120 3451 t
( hatched area,)2 490( The)1 173( scan line.)2 345(scan line followed immediately by the first word of the next)10 2116 4 1120 3571 t
8 CW f
(Bitmap.rect)4264 3571 w
8 PA f
(, stores)1 248 1 4792 3571 t
(the image.)1 366 1 1120 3691 t
10 CW f
(balloc\(\))970 3931 w
10 PA f
( which corresponds to the bitmap)5 1549(takes one argument, the on-screen rectangle)5 2004 2 1487 3931 t
( is defined thus:)3 702( Bitmap)1 371(image, and returns a pointer to a data structure of type Bitmap.)11 2797 3 720 4051 t
10 CW f
(typedef struct{)1 900 1 1080 4231 t
( start of data */)4 1020( /*)1 460(Word *base;)1 660 3 1330 4351 t
( width in words */)4 1080( /*)1 220(unsigned width;)1 900 3 1330 4471 t
( */)1 240( image rectangle)2 960( /*)1 220(Rectangle rect;)1 900 4 1330 4591 t
(}Bitmap;)1080 4711 w
10 PA f
(The declaration)1 701 1 720 4891 t
10 CW f
(Word *base)1 612 1 1458 4891 t
10 PA f
(states that)1 459 1 2107 4891 t
10 CW f
(base)2603 4891 w
10 PA f
( an object of type)4 803(points to)1 402 2 2880 4891 t
10 CW f
(Word)4123 4891 w
10 PA f
(, or rather that)3 677 1 4363 4891 t
10 CW f
(*base)720 5011 w
10 PA f
(is a)1 155 1 1054 5011 t
10 CW f
(Word)1243 5011 w
10 PA f
(pointed to by)2 611 1 1517 5011 t
10 CW f
(base)2162 5011 w
10 PA f
( not allocated dynami-)3 1019( in C can point to objects)6 1137(. \(Pointers)1 482 3 2402 5011 t
( illustrated in)2 613( elements of the structure are)5 1334( The)1 227(cally, and the layers software depends on this.\))7 2146 4 720 5131 t
(Figure 1.)1 395 1 720 5251 t
10 CW f
(width)1171 5251 w
10 PA f
(is in Words, which are some convenient unit of storage.)9 2507 1 1502 5251 t
10 CW f
(rect)4065 5251 w
10 PA f
( argument)1 463(is the)1 241 2 4336 5251 t
(to)720 5371 w
10 CW f
(balloc\(\))843 5371 w
10 PA f
( defines the coordinate system inside the Bitmap \(the next section, about the)12 3488(, and)1 229 2 1323 5371 t
( storage in the Bitmap outside)5 1354( The)1 223( explains why this is done\).)5 1233(Layer data structure,)2 938 4 720 5491 t
10 CW f
(rect)4499 5491 w
10 PA f
(\320 the)1 270 1 4770 5491 t
(unhatched portion in Figure 1 \320 is unused, as described above.)10 2810 1 720 5611 t
(Typically,)970 5767 w
10 CW f
(width)1439 5767 w
10 PA f
( of Words across the Bitmap, between the arrows in Figure)10 2652(is the number)2 619 2 1769 5767 t
( contained in another Bitmap, however, if)6 1884( Bitmap may be)3 720(1. A)1 212 3 720 5887 t
10 CW f
(width)3569 5887 w
10 PA f
(is the)1 243 1 3902 5887 t
10 CW f
(width)4178 5887 w
10 PA f
(of the outer)2 529 1 4511 5887 t
(Bitmap, and)1 552 1 720 6007 t
10 CW f
(base)1309 6007 w
10 PA f
(points as usual to the first Word in the Bitmap \320 the Word containing the)14 3453 1 1587 6007 t
(pixel at the)2 508 1 720 6127 t
10 CW f
(origin)1262 6127 w
10 PA f
( such Bitmaps are not created by)6 1490( Although)1 486(of the Bitmap.)2 641 3 1656 6127 t
10 CW f
(balloc\(\))4307 6127 w
10 PA f
(, they)1 253 1 4787 6127 t
(have utility \320 such as representing the portion of the screen occupied by a layer.)14 3573 1 720 6247 t
10 CW f
(balloc\(\))970 6403 w
10 PA f
(and its obvious counterpart)3 1221 1 1475 6403 t
10 CW f
(bfree\(\))2756 6403 w
10 PA f
( issues of storage management for)5 1510(hide all)1 329 2 3201 6403 t
( the sizes of bitmaps are widely variable,)7 1831(bitmaps. Because)1 790 2 720 6523 t
10 CW f
(balloc\(\))3371 6523 w
10 PA f
(does garbage compaction,)2 1160 1 3880 6523 t
( when space runs low, thereby ensuring that)7 1982(moving all allocated bitmaps to one end of the arena)9 2338 2 720 6643 t
(memory does not fragment.)3 1233 1 720 6763 t
( primitives operate)2 864( Graphics)1 461(The Bitmap structure is used throughout the layer software.)8 2745 3 970 6919 t
( screen itself is sim-)4 857( The)1 217( within Bitmaps, not necessarily the screen.)6 1904(on points, lines and rectangles)4 1342 4 720 7039 t
(ply a globally accessible Bitmap structure, called)6 2178 1 720 7159 t
10 CW f
(display)2929 7159 w
10 PA f
( unknown within the graphics)4 1364(, and is)2 327 2 3349 7159 t
(primitives.)720 7279 w
cleartomark
showpage
saveobj restore
%%EndPage: 4 6
%%Page: 5 7
/saveobj save def
mark
7 pagesetup
10 PA f
(- 5 -)2 166 1 2797 480 t
10 PB f
(Layers)720 840 w
10 PA f
( may be thought of)4 846( It)1 119( its associated image.)3 935(A layer is a rectangular portion of the screen and)9 2170 4 970 996 t
( may overlap \(although they need not\), but the image in the)11 2747( Layers)1 358(as a virtual display screen.)4 1215 3 720 1116 t
( a)1 78( an asynchronous process, such as)5 1513( Typically,)1 491(obscured portion of a layer is always kept current.)8 2238 4 720 1236 t
( circuit design system, draws pictures and text in a layer, just as it might)14 3381(terminal program or)2 939 2 720 1356 t
( Because)1 412(draw in any bitmap \(such as the full screen if it were the only process on the display\).)17 3908 2 720 1476 t
( any time in an obscured layer, and)7 1561(processes are asynchronous, drawing actions can take place at)8 2759 2 720 1596 t
( the screen and partially in the)6 1484(a graphical object such as a line may be partially visible on)11 2836 2 720 1716 t
( in a layer on the)5 782( layer software isolates a program drawing)6 1961( The)1 227(obscured portion of the layer.)4 1350 4 720 1836 t
( guarantees that the image on- and off-)7 1839(screen from other such programs in other layers, and)8 2481 2 720 1956 t
(screen is always correct, regardless of the configuration of the layers on the screen.)13 3647 1 720 2076 t
(Layers are different from the common notion of windows)8 2652 1 970 2232 t
(\262)3622 2182 w
( to)1 127( are used)2 425(. Windows)1 516 3 3672 2232 t
10 PI f
(save)4779 2232 w
10 PA f
(a)4990 2232 w
( ``interrupts'')1 595(programming or working environment, such as a text editing session, to process)11 3725 2 720 2352 t
( or to keep several)4 812(such as looking at a file or sending mail,)8 1774 2 720 2472 t
10 PI f
(static)3332 2472 w
10 PA f
(contexts, such as file contents, on)5 1464 1 3576 2472 t
( are intended to)3 712( Layers)1 352(the screen.)1 474 3 720 2592 t
10 PI f
(maintain)2288 2592 w
10 PA f
( even though it may change because)6 1621(an environment,)1 734 2 2685 2592 t
( example, a programmer could be editing the pro-)8 2256( For)1 206(the associated programs are still running.)5 1858 3 720 2712 t
( taking)1 309(gram source in one layer while watching for diagnostic messages from a long compilation)13 4011 2 720 2832 t
( another layer, and waiting for intruders into his corner of the labyrinth in a real-time)15 3965(place in)1 355 2 720 2952 t
( is, of course, nothing deep in the distinction between layers and)11 2995( There)1 319( third layer.)2 547(game in a)2 459 4 720 3072 t
( phrase ``asynchronous)2 1054(windows; the term ``layer'' was coined to avoid the more cumbersome)10 3266 2 720 3192 t
( concept)1 373( The)1 223( between layers and windows is significant.)6 1961( the difference)2 645(windows.'' Nonetheless,)1 1118 5 720 3312 t
(of multiple active contexts is natural to use and powerful to exploit.)11 2989 1 720 3432 t
( layer)1 251(Truly asynchronous graphics operations are difficult to support, because the state of a)12 3819 2 970 3588 t
( to perform)2 512( obvious simple solution is)4 1204( The)1 223(may change while a graphics operation is underway.)7 2381 4 720 3708 t
(graphical operations atomically by inhibiting process switches during calls to the layer software.)12 4261 1 720 3828 t
(Layer B)1 341 1 2080 5118 t
(Layer A)1 358 1 1621 4488 t
2682 5559 2700 5568 Dl
2700 5568 2682 5577 Dl
2520 5568 2538 5568 Dl
2538 5568 2610 5559 Dl
2610 5559 2610 5577 Dl
2611 5577 2682 5568 Dl
2682 5568 2700 5568 Dl
10 S1 f
(_ ___)1 180 1 2700 5568 t
10 S f
(\347)2700 5928 w
(\347)2700 5868 w
(\347)2700 5768 w
(\347)2700 5668 w
10 S1 f
(_ ___)1 180 1 2700 5928 t
10 S f
(\347)2880 5668 w
(\347)2880 5728 w
(\347)2880 5828 w
(\347)2880 5928 w
1980 4683 1980 4668 Dl
1980 4742 1980 4728 Dl
1980 4757 1980 4742 Dl
1980 4818 1980 4803 Dl
1980 4832 1980 4818 Dl
1980 4893 1980 4878 Dl
1980 4908 1980 4893 Dl
1980 4967 1980 4953 Dl
1980 4983 1980 4968 Dl
1980 5043 1980 5028 Dl
1980 5057 1980 5043 Dl
1980 5118 1980 5103 Dl
1980 5133 1980 5118 Dl
1980 5192 1980 5178 Dl
1980 5208 1980 5193 Dl
1980 5268 1980 5253 Dl
1980 5282 1980 5268 Dl
1980 5343 1980 5328 Dl
1980 5358 1980 5343 Dl
1980 5417 1980 5403 Dl
1980 5433 1980 5418 Dl
1980 5493 1980 5478 Dl
1980 5507 1980 5493 Dl
1980 5568 1980 5553 Dl
1995 5568 1980 5568 Dl
2056 5568 2041 5568 Dl
2072 5568 2057 5568 Dl
2133 5568 2118 5568 Dl
2149 5568 2134 5568 Dl
2211 5568 2196 5568 Dl
2226 5568 2211 5568 Dl
2288 5568 2273 5568 Dl
2303 5568 2288 5568 Dl
2365 5568 2350 5568 Dl
2380 5568 2365 5568 Dl
2442 5568 2427 5568 Dl
2457 5568 2442 5568 Dl
2519 5568 2504 5568 Dl
2520 5553 2520 5568 Dl
2520 5494 2520 5508 Dl
2520 5478 2520 5493 Dl
2520 5418 2520 5433 Dl
2520 5404 2520 5418 Dl
2520 5343 2520 5358 Dl
2520 5328 2520 5343 Dl
2520 5269 2520 5283 Dl
2520 5253 2520 5268 Dl
2520 5193 2520 5208 Dl
2520 5179 2520 5193 Dl
2520 5118 2520 5133 Dl
2520 5103 2520 5118 Dl
2520 5044 2520 5058 Dl
2520 5028 2520 5043 Dl
2520 4968 2520 4983 Dl
2520 4954 2520 4968 Dl
2520 4893 2520 4908 Dl
2520 4878 2520 4893 Dl
2520 4819 2520 4833 Dl
2520 4803 2520 4818 Dl
2520 4743 2520 4758 Dl
2520 4728 2520 4742 Dl
2520 4667 2520 4682 Dl
2505 4668 2520 4668 Dl
2443 4668 2458 4668 Dl
2427 4668 2442 4668 Dl
2366 4668 2381 4668 Dl
2350 4668 2365 4668 Dl
2289 4668 2304 4668 Dl
2273 4668 2288 4668 Dl
2211 4668 2226 4668 Dl
2196 4668 2211 4668 Dl
2134 4668 2149 4668 Dl
2119 4668 2134 4668 Dl
2057 4668 2072 4668 Dl
2042 4668 2057 4668 Dl
1980 4668 1995 4668 Dl
10 S1 f
(_ ______________)1 720 1 1440 3948 t
10 S f
(\347)1440 5028 w
(\347)1440 4948 w
(\347)1440 4848 w
(\347)1440 4748 w
(\347)1440 4648 w
(\347)1440 4548 w
(\347)1440 4448 w
(\347)1440 4348 w
(\347)1440 4248 w
(\347)1440 4148 w
(\347)1440 4048 w
10 S1 f
(_ ______________)1 720 1 1440 5028 t
10 S f
(\347)2160 4048 w
(\347)2160 4128 w
(\347)2160 4228 w
(\347)2160 4328 w
(\347)2160 4428 w
(\347)2160 4528 w
(\347)2160 4628 w
(\347)2160 4728 w
(\347)2160 4828 w
(\347)2160 4928 w
(\347)2160 5028 w
10 S1 f
(_ _______)1 360 1 2160 4668 t
10 S f
(\347)1980 5568 w
(\347)1980 5528 w
(\347)1980 5428 w
(\347)1980 5328 w
(\347)1980 5228 w
(\347)1980 5128 w
10 S1 f
(_ __________)1 540 1 1980 5568 t
10 S f
(\347)2520 4768 w
(\347)2520 4868 w
(\347)2520 4968 w
(\347)2520 5068 w
(\347)2520 5168 w
(\347)2520 5268 w
(\347)2520 5368 w
(\347)2520 5468 w
(\347)2520 5568 w
8 PA f
( portions of a layer are stored off-screen and linked to the obscured layer.)13 2584( Obscured)1 383(Figure 2.)1 311 3 1120 6204 t
10 PA f
( partially obscured layer)3 1097( A)1 134( for layers are illustrated in Figures 2 and 3.)9 1976(The data structures)2 863 4 970 6480 t
(has an)1 285 1 720 6600 t
10 PI f
(obscured list)1 509 1 1032 6600 t
10 R f
(:)1541 6600 w
10 PA f
(a list of disjoint rectangles)4 1157 1 1596 6600 t
10 PI f
(in that layer)2 496 1 2779 6600 t
10 PA f
( In)1 143(obscured by another layer or layers.)5 1596 2 3301 6600 t
( list has a single entry, which is marked)8 1829( B's obscured)2 606( Layer)1 315(Figure 2, layer A obscures layer B.)6 1570 4 720 6720 t
( more than one layer obscures a rectangle, the rectangle is marked as)12 3344( If)1 143(``obscured by A.'')2 833 3 720 6840 t
8 S1 f
(__________________)720 6940 w
8 PA f
(\262)720 7000 w
( meaning is actually closer to that)6 1197( The)1 176(The term ``window'' in common usage is a misnomer \(see e.g. [new79]\).)11 2547 3 760 7040 t
(of the older term ``viewport.'')4 1042 1 720 7140 t
cleartomark
showpage
saveobj restore
%%EndPage: 5 7
%%Page: 6 8
/saveobj save def
mark
8 pagesetup
10 PA f
(- 6 -)2 166 1 2797 480 t
(obscured by the)2 741 1 720 840 t
10 PI f
(frontmost)1504 840 w
10 PA f
( is illustrated by)3 768( This)1 259(\(unobscured\) layer intersecting the rectangle.)4 2072 3 1941 840 t
( 4 is an obscured part of both layers B and C, so these layers)14 2778( Rectangle)1 493( Figure 3.)2 434(rectangle 4 in)2 615 4 720 960 t
(store their obscured pieces off-screen, and mark them blocked by layer A.)11 3251 1 720 1080 t
(5)2081 1830 w
(4 3)1 -40 1 2081 2100 t
(2)2081 2370 w
(1)2315 2190 w
(5)4097 1830 w
(4)3809 1920 w
(2)3521 1830 w
(1)3107 2010 w
(4 3)1 -220 1 2981 3000 t
(Layer C)1 351 1 2237 1848 t
(Layer B)1 341 1 2080 2640 t
(Layer A)1 358 1 1621 1740 t
4050 1731 4068 1740 Dl
4068 1740 4050 1749 Dl
3888 1740 3906 1740 Dl
3907 1740 3978 1731 Dl
3978 1731 3978 1749 Dl
3979 1749 4050 1740 Dl
4050 1740 4068 1740 Dl
3762 1731 3780 1740 Dl
3780 1740 3762 1749 Dl
3600 1740 3618 1740 Dl
3618 1740 3690 1731 Dl
3690 1731 3690 1749 Dl
3691 1749 3762 1740 Dl
3762 1740 3780 1740 Dl
3474 1731 3492 1740 Dl
3492 1740 3474 1749 Dl
3312 1740 3330 1740 Dl
3331 1740 3402 1731 Dl
3402 1731 3402 1749 Dl
3402 1749 3474 1740 Dl
3474 1740 3492 1740 Dl
2934 1731 2952 1740 Dl
2952 1740 2934 1749 Dl
2772 1740 2790 1740 Dl
2790 1740 2862 1731 Dl
2862 1731 2862 1749 Dl
2863 1749 2934 1740 Dl
2934 1740 2952 1740 Dl
4176 1740 4068 1740 Dl
10 S f
(\347)4068 1920 w
(\347)4068 1840 w
4068 1920 4176 1920 Dl
(\347)4176 1840 w
(\347)4176 1920 w
3888 1740 3780 1740 Dl
(\347)3780 2100 w
(\347)3780 2040 w
(\347)3780 1940 w
(\347)3780 1840 w
3780 2100 3888 2100 Dl
(\347)3888 1840 w
(\347)3888 1900 w
(\347)3888 2000 w
(\347)3888 2100 w
3600 1740 3492 1740 Dl
(\347)3492 1920 w
(\347)3492 1840 w
3492 1920 3600 1920 Dl
(\347)3600 1840 w
(\347)3600 1920 w
10 S1 f
(_ _______)1 360 1 2952 1740 t
10 S f
(\347)2952 2280 w
(\347)2952 2240 w
(\347)2952 2140 w
(\347)2952 2040 w
(\347)2952 1940 w
(\347)2952 1840 w
10 S1 f
(_ _______)1 360 1 2952 2280 t
10 S f
(\347)3312 1840 w
(\347)3312 1880 w
(\347)3312 1980 w
(\347)3312 2080 w
(\347)3312 2180 w
(\347)3312 2280 w
2934 2811 2952 2820 Dl
2952 2820 2934 2829 Dl
2772 2820 2790 2820 Dl
2790 2820 2862 2811 Dl
2862 2811 2862 2829 Dl
2863 2829 2934 2820 Dl
2934 2820 2952 2820 Dl
3060 2820 2952 2820 Dl
(\347)2952 3180 w
(\347)2952 3120 w
(\347)2952 3020 w
(\347)2952 2920 w
2952 3180 3060 3180 Dl
(\347)3060 2920 w
(\347)3060 2980 w
(\347)3060 3080 w
(\347)3060 3180 w
2682 2811 2700 2820 Dl
2700 2820 2682 2829 Dl
2520 2820 2538 2820 Dl
2538 2820 2610 2811 Dl
2610 2811 2610 2829 Dl
2611 2829 2682 2820 Dl
2682 2820 2700 2820 Dl
2772 2820 2700 2820 Dl
(\347)2700 3180 w
(\347)2700 3120 w
(\347)2700 3020 w
(\347)2700 2920 w
2700 3180 2772 3180 Dl
(\347)2772 2920 w
(\347)2772 2980 w
(\347)2772 3080 w
(\347)2772 3180 w
2160 2442 2160 2460 Dl
2160 2370 2160 2388 Dl
2160 2352 2160 2370 Dl
2160 2280 2160 2298 Dl
2052 1754 2052 1740 Dl
2052 1811 2052 1797 Dl
2052 1826 2052 1812 Dl
2052 1883 2052 1869 Dl
2052 1898 2052 1884 Dl
2052 1955 2052 1941 Dl
2052 1970 2052 1956 Dl
2052 2027 2052 2013 Dl
2052 2042 2052 2028 Dl
2052 2099 2052 2085 Dl
2052 2114 2052 2100 Dl
2052 2171 2052 2157 Dl
2052 2186 2052 2172 Dl
2052 2243 2052 2229 Dl
2052 2258 2052 2244 Dl
2052 2315 2052 2301 Dl
2052 2330 2052 2316 Dl
2052 2387 2052 2373 Dl
2052 2402 2052 2388 Dl
2052 2459 2052 2445 Dl
2066 2460 2052 2460 Dl
2123 2460 2109 2460 Dl
2138 2460 2124 2460 Dl
2195 2460 2181 2460 Dl
2210 2460 2196 2460 Dl
2267 2460 2253 2460 Dl
2282 2460 2268 2460 Dl
2339 2460 2325 2460 Dl
2354 2460 2340 2460 Dl
2411 2460 2397 2460 Dl
2426 2460 2412 2460 Dl
2483 2460 2469 2460 Dl
2498 2460 2484 2460 Dl
2555 2460 2541 2460 Dl
2570 2460 2556 2460 Dl
2627 2460 2613 2460 Dl
2642 2460 2628 2460 Dl
2699 2460 2685 2460 Dl
2714 2460 2700 2460 Dl
2771 2460 2757 2460 Dl
2772 2445 2772 2460 Dl
2772 2380 2772 2395 Dl
2772 2364 2772 2380 Dl
2772 2301 2772 2316 Dl
2772 2284 2772 2300 Dl
2772 2220 2772 2236 Dl
2772 2205 2772 2220 Dl
2772 2140 2772 2156 Dl
2772 2125 2772 2140 Dl
2772 2061 2772 2076 Dl
2772 2044 2772 2060 Dl
2772 1981 2772 1996 Dl
2772 1964 2772 1980 Dl
2772 1900 2772 1916 Dl
2772 1884 2772 1899 Dl
2772 1820 2772 1836 Dl
2772 1804 2772 1819 Dl
2772 1740 2772 1755 Dl
2758 1740 2772 1740 Dl
2700 1740 2714 1740 Dl
2686 1740 2700 1740 Dl
2628 1740 2642 1740 Dl
2614 1740 2628 1740 Dl
2556 1740 2570 1740 Dl
2542 1740 2556 1740 Dl
2484 1740 2498 1740 Dl
2470 1740 2484 1740 Dl
2412 1740 2426 1740 Dl
2398 1740 2412 1740 Dl
2340 1740 2354 1740 Dl
2326 1740 2340 1740 Dl
2268 1740 2282 1740 Dl
2254 1740 2268 1740 Dl
2196 1740 2210 1740 Dl
2182 1740 2196 1740 Dl
2124 1740 2138 1740 Dl
2110 1740 2124 1740 Dl
2052 1740 2066 1740 Dl
1980 1935 1980 1920 Dl
1980 1994 1980 1980 Dl
1980 2009 1980 1994 Dl
1980 2070 1980 2055 Dl
1980 2084 1980 2070 Dl
1980 2145 1980 2130 Dl
1980 2160 1980 2145 Dl
1980 2219 1980 2205 Dl
1980 2235 1980 2220 Dl
1980 2295 1980 2280 Dl
1980 2309 1980 2295 Dl
1980 2370 1980 2355 Dl
1980 2385 1980 2370 Dl
1980 2444 1980 2430 Dl
1980 2460 1980 2445 Dl
1980 2520 1980 2505 Dl
1980 2534 1980 2520 Dl
1980 2595 1980 2580 Dl
1980 2610 1980 2595 Dl
1980 2669 1980 2655 Dl
1980 2685 1980 2670 Dl
1980 2745 1980 2730 Dl
1980 2759 1980 2745 Dl
1980 2820 1980 2805 Dl
1995 2820 1980 2820 Dl
2056 2820 2041 2820 Dl
2072 2820 2057 2820 Dl
2133 2820 2118 2820 Dl
2149 2820 2134 2820 Dl
2211 2820 2196 2820 Dl
2226 2820 2211 2820 Dl
2288 2820 2273 2820 Dl
2303 2820 2288 2820 Dl
2365 2820 2350 2820 Dl
2380 2820 2365 2820 Dl
2442 2820 2427 2820 Dl
2457 2820 2442 2820 Dl
2519 2820 2504 2820 Dl
2520 2805 2520 2820 Dl
2520 2746 2520 2760 Dl
2520 2730 2520 2745 Dl
2520 2670 2520 2685 Dl
2520 2656 2520 2670 Dl
2520 2595 2520 2610 Dl
2520 2580 2520 2595 Dl
2520 2521 2520 2535 Dl
2520 2505 2520 2520 Dl
2520 2445 2520 2460 Dl
2520 2431 2520 2445 Dl
2520 2370 2520 2385 Dl
2520 2355 2520 2370 Dl
2520 2296 2520 2310 Dl
2520 2280 2520 2295 Dl
2520 2220 2520 2235 Dl
2520 2206 2520 2220 Dl
2520 2145 2520 2160 Dl
2520 2130 2520 2145 Dl
2520 2071 2520 2085 Dl
2520 2055 2520 2070 Dl
2520 1995 2520 2010 Dl
2520 1980 2520 1994 Dl
2520 1919 2520 1934 Dl
2505 1920 2520 1920 Dl
2443 1920 2458 1920 Dl
2427 1920 2442 1920 Dl
2366 1920 2381 1920 Dl
2350 1920 2365 1920 Dl
2289 1920 2304 1920 Dl
2273 1920 2288 1920 Dl
2211 1920 2226 1920 Dl
2196 1920 2211 1920 Dl
2134 1920 2149 1920 Dl
2119 1920 2134 1920 Dl
2057 1920 2072 1920 Dl
2042 1920 2057 1920 Dl
1980 1920 1995 1920 Dl
10 S1 f
(_ ______________)1 720 1 1440 1200 t
10 S f
(\347)1440 2280 w
(\347)1440 2200 w
(\347)1440 2100 w
(\347)1440 2000 w
(\347)1440 1900 w
(\347)1440 1800 w
(\347)1440 1700 w
(\347)1440 1600 w
(\347)1440 1500 w
(\347)1440 1400 w
(\347)1440 1300 w
10 S1 f
(_ ______________)1 720 1 1440 2280 t
10 S f
(\347)2160 1300 w
(\347)2160 1380 w
(\347)2160 1480 w
(\347)2160 1580 w
(\347)2160 1680 w
(\347)2160 1780 w
(\347)2160 1880 w
(\347)2160 1980 w
(\347)2160 2080 w
(\347)2160 2180 w
(\347)2160 2280 w
10 S1 f
(_ _______)1 360 1 2160 1920 t
10 S f
(\347)1980 2820 w
(\347)1980 2780 w
(\347)1980 2680 w
(\347)1980 2580 w
(\347)1980 2480 w
(\347)1980 2380 w
10 S1 f
(_ __________)1 540 1 1980 2820 t
10 S f
(\347)2520 2020 w
(\347)2520 2120 w
(\347)2520 2220 w
(\347)2520 2320 w
(\347)2520 2420 w
(\347)2520 2520 w
(\347)2520 2620 w
(\347)2520 2720 w
(\347)2520 2820 w
10 S1 f
(_ ____________)1 612 1 2160 1740 t
(_ _____)1 252 1 2520 2460 t
10 S f
(\347)2772 1840 w
(\347)2772 1860 w
(\347)2772 1960 w
(\347)2772 2060 w
(\347)2772 2160 w
(\347)2772 2260 w
(\347)2772 2360 w
(\347)2772 2460 w
8 PA f
( of)1 101( addition)1 330( The)1 183( 4 is obscured in layers B and C, and is maintained off-screen by both.)14 2590( Rectangle)1 395(Figure 3.)1 321 6 1120 3456 t
(layer C divides the obscured part of layer B into two rectangles, 3 and 4.)14 2540 1 1120 3576 t
10 PA f
( B \(Figure 3\) may be stored as a single rectangle, as they were in)14 2876(Rectangles 3 and 4 in layer)5 1194 2 970 3852 t
( to the front of the screen \(i.e.)7 1330( are stored as two because if layer C is later moved)11 2314( They)1 280(Figure 2.)1 396 4 720 3972 t
( 4 in layer)3 447( Rectangle)1 487( of layers\), it will obscure portions of both layers A and B.)12 2594(the top of the pile)4 792 4 720 4092 t
( algo-)1 256( simplify the)2 573( To)1 175(B would be obscured by C, but rectangle 3 would still be obscured by A.)14 3316 4 720 4212 t
( layers, the layer creation routine does all necessary subdivision when the)11 3317(rithms for rearranging)2 1003 2 720 4332 t
(layer is first made, so when layer C is created)9 2064 1 720 4452 t
(*)2784 4402 w
( split in two along)4 831(, the obscured rectangle in B is)6 1386 2 2823 4452 t
(the edge of the new layer.)5 1141 1 720 4572 t
(The layer structure is:)3 961 1 970 4728 t
10 CW f
(typedef struct{)1 900 1 1080 4908 t
( start of data */)4 1020( /*)1 460(Word *base;)1 660 3 1330 5028 t
( width in words */)4 1080( /*)1 220(unsigned width;)1 900 3 1330 5148 t
( */)1 240( image rectangle)2 960( /*)1 220(Rectangle rect;)1 900 4 1330 5268 t
( linked list of obscured rectangles */)6 2280( /*)1 280(Obscured *obs;)1 840 3 1330 5388 t
( adjacent layer in front */)5 1620( /*)1 340(Layer *front;)1 780 3 1330 5508 t
( adjacent layer behind */)4 1500( /*)1 400(Layer *back;)1 720 3 1330 5628 t
(} Layer;)1 480 1 1080 5748 t
(typedef struct{)1 900 1 1080 5868 t
( frontmost obscuring Layer */)4 1740( /*)1 400(Layer *lobs;)1 720 3 1330 5988 t
( where the obscured data resides */)6 2100( /*)1 340(Bitmap *bmap;)1 780 3 1330 6108 t
( chaining */)2 720( /*)1 220(Obscured *next;)1 900 3 1330 6228 t
(Obscured *prev;)1 900 1 1330 6348 t
(} Obscured;)1 660 1 1080 6468 t
10 PA f
( the Bitmap)2 532( Actually,)1 465( of the Layer structure is identical to that of a Bitmap.)11 2476(The first part)2 597 4 970 6684 t
(structure has an extra item to it: a)7 1549 1 720 6804 t
10 CW f
(NULL obs)1 455 1 2304 6804 t
10 PA f
( a graphics)2 497(pointer, so a Bitmap may be passed to)7 1749 2 2794 6804 t
( next section explains, among other things, why a)8 2294( The)1 230(routine expecting a Layer as argument.)5 1796 3 720 6924 t
8 S1 f
(__________________)720 7024 w
8 PA f
(*)720 7084 w
(Despite Figure 3, layer C is actually created at the)9 1746 1 771 7124 t
8 PI f
(front,)2537 7124 w
8 PA f
(but the argument is nonetheless true.)5 1307 1 2736 7124 t
cleartomark
showpage
saveobj restore
%%EndPage: 6 8
%%Page: 7 9
/saveobj save def
mark
9 pagesetup
10 PA f
(- 7 -)2 166 1 2797 480 t
(Bitmap with a)2 624 1 720 840 t
10 CW f
(NULL obs)1 445 1 1369 840 t
10 PA f
(pointer looks like a Layer \(and vice versa\).)7 1875 1 1839 840 t
( Layers are chained together as a doubly-linked list, in order from ``front'' to)13 3414(The individual)1 656 2 970 996 t
( the link point-)3 669( Besides)1 387(``back'' on the screen \(when they do not overlap, the order is irrelevant\).)12 3264 3 720 1116 t
( Layer structure contains a pointer to the list of obscured rectangles and the bounding rect-)15 4086(ers, a)1 234 2 720 1236 t
( Each)1 270( no particular order.)3 913( obscured lists are also doubly linked, but in)8 2015( The)1 225(angle on the screen.)3 897 5 720 1356 t
( contains a Bitmap for storing the off-screen image, and a pointer to)12 3076(element in the obscured list)4 1244 2 720 1476 t
( we shall see later, an Obscured element need only record)10 2542( As)1 170(the frontmost Layer that obscures it.)5 1608 3 720 1596 t
( ``in front'' of it, not any other obscured Layers which)10 2421(which \(unobscured\) Layer is on the screen)6 1899 2 720 1716 t
( screen coordinates of the obscured Rectangle are held)8 2450( The)1 224( the screen.)2 508(also share that portion of)4 1138 4 720 1836 t
(in the)1 305 1 720 1956 t
10 CW f
(rect)1104 1956 w
10 PA f
(field of the)2 585 1 1423 1956 t
10 CW f
(Bitmap)2087 1956 w
10 PA f
( to by the)3 578(structure pointed)1 823 2 2526 1956 t
10 CW f
(Obscured)4007 1956 w
10 PA f
(list entry,)1 473 1 4567 1956 t
10 CW f
(Obscured.bmap->rect)720 2076 w
10 PA f
( coordinates in the layer manipulations are screen coordinates.)8 2763(. All)1 211 2 1860 2076 t
( a Bitmap holding an obscured rectangle of a Layer has in its)12 2742(Note that)1 423 2 970 2232 t
10 CW f
(rect)4166 2232 w
10 PA f
(field a defini-)2 603 1 4437 2232 t
( is an appealing model: as a Layer's)7 1595( This)1 244( screen space it would occupy were it visible.)8 2019(tion of the)2 462 4 720 2352 t
( More)1 304(contents are subdivided into visible and obscured portions, so is its coordinate system.)12 4016 2 720 2472 t
( it)1 97(generally, since a Layer structure must contain a rectangle defining the portion of the screen)14 4223 2 720 2592 t
(occupies, so must a Bitmap, because Layers are simply a generalization of Bitmaps.)12 3668 1 720 2712 t
10 PB f
(Layerop)720 2952 w
10 CW f
(layerop\(\))970 3108 w
10 PA f
( Given)1 318(is the main interface between layers and the bitmap graphics primitives.)10 3187 2 1535 3108 t
( a bitmap operator, it recursively subdivides the Rect-)8 2412(a Layer, a Rectangle within the Layer, and)7 1908 2 720 3228 t
( Rectangles contained in single Bitmaps, and invokes the operator on the)11 3824(angle into)1 496 2 720 3348 t
( simplify the operators,)3 1061( To)1 177(Rectangle/Bitmap pairs.)1 1097 3 720 3468 t
10 CW f
(layerop\(\))3090 3468 w
10 PA f
(also passes along, unaltered, a)4 1375 1 3665 3468 t
( example, to clear a rectangle in a layer,)8 1756( For)1 203( a set of parameters to the bitmap operator.)8 1924(pointer to)1 437 4 720 3588 t
10 CW f
(layerop\(\))720 3708 w
10 PA f
(is called with the target Layer, the rectangle within the layer in screen coordinates,)13 3747 1 1293 3708 t
(and a procedure \(the bitmap operator\) to invoke)7 2239 1 720 3828 t
10 CW f
(rectf\(\))2999 3828 w
10 PA f
(.)3419 3828 w
10 CW f
(layerop\(\))3509 3828 w
10 PA f
(divides the rectangle)2 951 1 4089 3828 t
( clear)1 238(into its components in obscured and visible portions of the layer, and calls the procedure to)15 4082 2 720 3948 t
( the end of this section.)5 1100( complete example is worked through at)6 1883( A)1 144(the component rectangles.)2 1193 4 720 4068 t
10 CW f
(layerop\(\))720 4188 w
10 PA f
(itself does no graphical operation, it merely)6 1923 1 1285 4188 t
10 PI f
(controls)3233 4188 w
10 PA f
(graphical operations done by the)4 1458 1 3582 4188 t
( is a functional that turns a bitmap operator into a layer operator.)12 2877( It)1 117(bitmap operator handed to it.)4 1307 3 720 4308 t
10 CW f
(layerop\(\))970 4464 w
10 PA f
( calls the recursive routine)4 1235(first clips the target Rectangle to the Layer, then)8 2253 2 1552 4464 t
10 CW f
(Rlayerop\(\))720 4584 w
10 PA f
(to do the subdivision:)3 959 1 1345 4584 t
10 CW f
(/*)1080 4764 w
(* Clip to outer rectangle of layer, then call Rlayerop\(\))9 3360 1 1140 4884 t
(*/)1140 5004 w
(layerop\(lp, fn, r, otherargs\))3 1740 1 1080 5124 t
(Layer *lp;)1 600 1 1330 5244 t
( Pointer to bitmap operator */)5 1800( /*)1 290(procedure \(*fn\)\(\);)1 1080 3 1330 5364 t
(Rectangle r;)1 720 1 1330 5484 t
( Other arguments used by \(*fn\)\(\) */)6 2100( /*)1 220(misc otherargs;)1 900 3 1330 5604 t
({)1080 5724 w
(r = intersection of r and lp->rect;)6 2100 1 1330 5844 t
(if\(r not null\))2 840 1 1330 5964 t
(Rlayerop\(lp, fn, r, otherargs, lp->obs\);)4 2400 1 1580 6084 t
(})1080 6204 w
10 PA f
(The argument)1 634 1 720 6384 t
10 CW f
(\(*fn\)\(\))1389 6384 w
10 PA f
(is the pointer to the bitmap-level procedure.)6 2009 1 1844 6384 t
10 CW f
(Rlayerop\(\))3913 6384 w
10 PA f
(recursively)4548 6384 w
( intersection of the)3 846( the)1 198( obscured list of the Layer, performing the operation on)9 2538(chains along the)2 738 4 720 6504 t
( and the obscured Bitmap, and passing non-intersecting portions on to be)11 3414(argument Rectangle)1 906 2 720 6624 t
( obscured list is empty, the rectan-)6 1532( the)1 168( When)1 318(intersected with other Bitmaps on the obscured list.)7 2302 4 720 6744 t
(gle must be drawn on the screen.)6 1458 1 720 6864 t
(The code to test if two rectangles overlap is simple, but not well known:)13 3173 1 970 7020 t
cleartomark
showpage
saveobj restore
%%EndPage: 7 9
%%Page: 8 10
/saveobj save def
mark
10 pagesetup
10 PA f
(- 8 -)2 166 1 2797 480 t
10 CW f
( Do r and s intersect? */)6 1500( /*)1 220(rectXrect\(r, s\))1 900 3 1080 900 t
(Rectangle r, s;)2 900 1 1330 1020 t
({)1080 1140 w
(return\(r.origin.x < s.corner.x &&)3 1980 1 1330 1260 t
(s.origin.x < r.corner.x &&)3 1560 1 1750 1380 t
(r.origin.y < s.corner.y &&)3 1560 1 1750 1500 t
( \);)1 300(s.origin.y < r.corner.y)2 1380 2 1750 1620 t
(})1080 1740 w
10 PA f
(The C)1 265 1 720 1920 t
10 CW f
(&&)1012 1920 w
10 PA f
( left operand is)3 670(operator is a logical AND that does not evaluate the right operand if the)13 3211 2 1159 1920 t
( the)1 164(false. Similarly,)1 705 2 720 2040 t
10 CW f
(==)1614 2040 w
10 PA f
(operator used below is the equality operator.)6 1989 1 1759 2040 t
(Here is Rlayerop:)2 770 1 970 2196 t
10 CW f
(/*)1080 2376 w
(* Rlayerop -- recursively subdivide and intersect)6 2940 1 1140 2496 t
( with obscured bitmaps in layer)5 1860(* rectangles)1 1040 2 1140 2616 t
(*/)1140 2736 w
(Rlayerop\(lp, fn, r, otherargs, op\))4 2040 1 1080 2856 t
(Layer *lp;)1 600 1 1330 2976 t
(procedure \(*fn\)\(\);)1 1080 1 1330 3096 t
(Rectangle r;)1 720 1 1330 3216 t
(misc otherargs;)1 900 1 1330 3336 t
( Element of obscured list with which)6 2160( /*)1 340(Obscured *op;)1 780 3 1330 3456 t
(to intersect r */)3 1020 1 2330 3576 t
({)1080 3696 w
( This rectangle not obscured */)5 1860( /*)1 530(if\(op == NULL\))2 840 3 1330 3816 t
( Draw on screen */)4 1080( /*)1 150(\(*fn\)\(lp, r, display, otherargs, op\);)4 2220 3 1580 3936 t
( They miss */)3 780( /*)1 360(else if\(rectXrect\(r, op->bmap->rect\) == FALSE\))4 2760 3 1330 4056 t
( Chain */)2 540( /*)1 160(Rlayerop\(lp, fn, r, otherargs, op->next\);)4 2460 3 1580 4176 t
( They must intersect */)4 1380(else{ /*)1 870 2 1330 4296 t
(if\(r.origin.x < op->bmap->rect.origin.x\){)2 2460 1 1580 4416 t
(Rectangle temp = piece of r left of op->bmap->rect;)8 3060 1 1830 4536 t
(Rlayerop\(lp, fn, temp, otherargs, op->next\);)4 2640 1 1830 4656 t
(r->origin.x = op->bmap->rect.origin.x;)2 2280 1 1830 4776 t
(})1580 4896 w
(/* etc. for other three sides of rectangle */)8 2700 1 1580 5016 t
(/* What's left goes in this obscured bitmap */)8 2760 1 1580 5136 t
(\(*fn\)\(lp, r, op->bmap, otherargs, op\);)4 2280 1 1580 5256 t
(})1330 5376 w
(})1080 5496 w
10 PA f
( operator \()2 508(The Layer pointer and Obscured pointer are passed to the bitmap)10 3109 2 970 5712 t
10 CW f
(\(*fn\)\(\))4587 5712 w
10 PA f
(\))5007 5712 w
(because, although they are clearly not needed for graphical operations,)9 3143 1 720 5832 t
10 CW f
(layerop\(\))3889 5832 w
10 PA f
('s subdivision)1 611 1 4429 5832 t
( themselves; we)2 718(is useful enough to be exploited by some of the software to maintain the layers)14 3602 2 720 5952 t
( if)1 98( that)1 211( Note)1 281(will see an example of such usage later on.)8 1973 4 720 6072 t
10 CW f
(layerop\(\))3319 6072 w
10 PA f
(is handed a Layer with a)5 1145 1 3895 6072 t
10 CW f
(NULL obs)1 447 1 720 6192 t
10 PA f
( opera-)1 314(pointer, or a Bitmap, its effect is simply to clip the rectangle and call the bitmap)15 3532 2 1194 6192 t
(tor.)720 6312 w
(So far,)1 287 1 970 6468 t
10 CW f
(otherargs)1288 6468 w
10 PA f
( practice,)1 405( In)1 149( vague manner.)2 701(has been referred to in a deliberately)6 1654 4 1859 6468 t
10 CW f
(lay-)4800 6468 w
(erop\(\))720 6588 w
10 PA f
(works something like the standard C formatted output routine)8 2935 1 1125 6588 t
10 CW f
(printf\(\))4104 6588 w
10 PA f
(: after the)2 456 1 4584 6588 t
(arguments required by)2 1024 1 720 6708 t
10 CW f
(layerop\(\))1772 6708 w
10 PA f
( operator and Rectangle\), the calling func-)6 1877(\(the Layer, bitmap)2 823 2 2340 6708 t
(tion passes the further arguments needed by the Bitmap operator.)9 3172 1 720 6828 t
10 CW f
(layerop\(\))3971 6828 w
10 PA f
(passes the)1 476 1 4564 6828 t
( operator, which therefore sees a pointer to)7 1932(address of the first of these arguments through to the)9 2388 2 720 6948 t
(a structure containing the necessary arguments.)5 2112 1 720 7068 t
(The following example illustrates the action of)6 2098 1 970 7224 t
10 CW f
(layerop\(\))3101 7224 w
10 PA f
( we will see several)4 888(. Although)1 511 2 3641 7224 t
cleartomark
showpage
saveobj restore
%%EndPage: 8 10
%%Page: 9 11
/saveobj save def
mark
11 pagesetup
10 PA f
(- 9 -)2 166 1 2797 480 t
(examples later, this is the simplest and most common use.)9 2632 1 720 840 t
10 CW f
(lblt\(\))3410 840 w
10 PA f
(uses)3803 840 w
10 CW f
(layerop\(\))4027 840 w
10 PA f
(and)4599 840 w
10 CW f
(bit-)4800 840 w
(blt\(\))720 960 w
10 PA f
( Bitmap may contain, for)4 1115( The)1 222( Bitmap to a Rectangle within a Layer.)7 1722(to copy an off-screen)3 932 4 1049 960 t
( of copying a Rectangle from one Layer to another will be)11 2583( general case)2 573( The)1 222(example, a character.)2 942 4 720 1080 t
(discussed later.)1 679 1 720 1200 t
10 CW f
(Lblt\(l, r, db, fp, o\))4 1260 1 1080 1380 t
(Layer *l;)1 540 1 1330 1500 t
(Rectangle r;)1 720 1 1330 1620 t
( Destination Bitmap */)3 1320( /*)1 460(Bitmap *db;)1 660 3 1330 1740 t
(struct{)1330 1860 w
( Source Bitmap */)3 1020( /*)1 210(Bitmap *sb;)1 660 3 1580 1980 t
( Function code */)3 1020( /*)1 510(int f;)1 360 3 1580 2100 t
(} *fp;)1 360 1 1330 2220 t
(Obscured *o;)1 720 1 1330 2340 t
({)1080 2460 w
(bitblt\(fp->sb, r, db, r.origin, fp->f\);)4 2340 1 1330 2580 t
(})1080 2700 w
(lblt\(l, sb, r, f\))3 1020 1 1080 2940 t
(Layer *l;)1 540 1 1330 3060 t
(Bitmap *sb;)1 660 1 1330 3180 t
(Rectangle r;)1 720 1 1330 3300 t
({)1080 3420 w
(layerop\(l, Lblt, r, sb, f\);)4 1620 1 1330 3540 t
(})1080 3660 w
10 PA f
( Bitmap is in screen)4 871( code assumes the source)4 1116( This)1 242(Notice that the bulk of the code is declarations.)8 2091 4 720 3840 t
(coordinates; if it were not, extra arguments to)7 2050 1 720 3960 t
10 CW f
(lblt\(\))2800 3960 w
10 PA f
( operation routine)2 809(would be passed to the)4 1041 2 3190 3960 t
10 CW f
(Lblt\(\))720 4080 w
10 PA f
( ``extra'' arguments to)3 1021( The)1 233( transformation.)1 730(to describe the necessary coordinate)4 1655 4 1120 4080 t
10 CW f
(lay-)4800 4080 w
(erop)720 4200 w
10 PA f
(,)960 4200 w
10 CW f
(sb)1010 4200 w
10 PA f
(and)1155 4200 w
10 CW f
(f)1349 4200 w
10 PA f
(, are seen by)3 545 1 1409 4200 t
10 CW f
(Lblt)1979 4200 w
10 PA f
(as elements of a structure pointed to by)7 1742 1 2244 4200 t
10 CW f
(fp)4011 4200 w
10 PA f
(.)4131 4200 w
3240 6192 3132 6192 Dl
3132 6192 3132 6300 Dl
3132 6300 3240 6300 Dl
3240 6300 3240 6192 Dl
10 S1 f
(_ _____)1 252 1 2412 5292 t
2412 5292 2412 5400 Dl
(_ _____)1 252 1 2412 5400 t
2664 5400 2664 5292 Dl
2412 5391 2664 5300 Dl
10 CW f
(Layer B)1 420 1 2400 5670 t
(Layer A)1 420 1 1950 5040 t
3042 6111 3060 6120 Dl
3060 6120 3042 6129 Dl
2880 6120 2898 6120 Dl
2898 6120 2970 6111 Dl
2970 6111 2970 6129 Dl
2971 6129 3042 6120 Dl
3042 6120 3060 6120 Dl
10 S1 f
(_ ___)1 180 1 3060 6120 t
10 S f
(\347)3060 6480 w
(\347)3060 6420 w
(\347)3060 6320 w
(\347)3060 6220 w
10 S1 f
(_ ___)1 180 1 3060 6480 t
10 S f
(\347)3240 6220 w
(\347)3240 6280 w
(\347)3240 6380 w
(\347)3240 6480 w
2340 5235 2340 5220 Dl
2340 5294 2340 5280 Dl
2340 5309 2340 5294 Dl
2340 5370 2340 5355 Dl
2340 5384 2340 5370 Dl
2340 5445 2340 5430 Dl
2340 5460 2340 5445 Dl
2340 5519 2340 5505 Dl
2340 5535 2340 5520 Dl
2340 5595 2340 5580 Dl
2340 5609 2340 5595 Dl
2340 5670 2340 5655 Dl
2340 5685 2340 5670 Dl
2340 5744 2340 5730 Dl
2340 5760 2340 5745 Dl
2340 5820 2340 5805 Dl
2340 5834 2340 5820 Dl
2340 5895 2340 5880 Dl
2340 5910 2340 5895 Dl
2340 5969 2340 5955 Dl
2340 5985 2340 5970 Dl
2340 6045 2340 6030 Dl
2340 6059 2340 6045 Dl
2340 6120 2340 6105 Dl
2355 6120 2340 6120 Dl
2416 6120 2401 6120 Dl
2432 6120 2417 6120 Dl
2493 6120 2478 6120 Dl
2509 6120 2494 6120 Dl
2571 6120 2556 6120 Dl
2586 6120 2571 6120 Dl
2648 6120 2633 6120 Dl
2663 6120 2648 6120 Dl
2725 6120 2710 6120 Dl
2740 6120 2725 6120 Dl
2802 6120 2787 6120 Dl
2817 6120 2802 6120 Dl
2879 6120 2864 6120 Dl
2880 6105 2880 6120 Dl
2880 6046 2880 6060 Dl
2880 6030 2880 6045 Dl
2880 5970 2880 5985 Dl
2880 5956 2880 5970 Dl
2880 5895 2880 5910 Dl
2880 5880 2880 5895 Dl
2880 5821 2880 5835 Dl
2880 5805 2880 5820 Dl
2880 5745 2880 5760 Dl
2880 5731 2880 5745 Dl
2880 5670 2880 5685 Dl
2880 5655 2880 5670 Dl
2880 5596 2880 5610 Dl
2880 5580 2880 5595 Dl
2880 5520 2880 5535 Dl
2880 5506 2880 5520 Dl
2880 5445 2880 5460 Dl
2880 5430 2880 5445 Dl
2880 5371 2880 5385 Dl
2880 5355 2880 5370 Dl
2880 5295 2880 5310 Dl
2880 5280 2880 5294 Dl
2880 5219 2880 5234 Dl
2865 5220 2880 5220 Dl
2803 5220 2818 5220 Dl
2787 5220 2802 5220 Dl
2726 5220 2741 5220 Dl
2710 5220 2725 5220 Dl
2649 5220 2664 5220 Dl
2633 5220 2648 5220 Dl
2571 5220 2586 5220 Dl
2556 5220 2571 5220 Dl
2494 5220 2509 5220 Dl
2479 5220 2494 5220 Dl
2417 5220 2432 5220 Dl
2402 5220 2417 5220 Dl
2340 5220 2355 5220 Dl
10 S1 f
(_ ______________)1 720 1 1800 4500 t
10 S f
(\347)1800 5580 w
(\347)1800 5500 w
(\347)1800 5400 w
(\347)1800 5300 w
(\347)1800 5200 w
(\347)1800 5100 w
(\347)1800 5000 w
(\347)1800 4900 w
(\347)1800 4800 w
(\347)1800 4700 w
(\347)1800 4600 w
10 S1 f
(_ ______________)1 720 1 1800 5580 t
10 S f
(\347)2520 4600 w
(\347)2520 4680 w
(\347)2520 4780 w
(\347)2520 4880 w
(\347)2520 4980 w
(\347)2520 5080 w
(\347)2520 5180 w
(\347)2520 5280 w
(\347)2520 5380 w
(\347)2520 5480 w
(\347)2520 5580 w
10 S1 f
(_ _______)1 360 1 2520 5220 t
10 S f
(\347)2340 6120 w
(\347)2340 6080 w
(\347)2340 5980 w
(\347)2340 5880 w
(\347)2340 5780 w
(\347)2340 5680 w
10 S1 f
(_ __________)1 540 1 2340 6120 t
10 S f
(\347)2880 5320 w
(\347)2880 5420 w
(\347)2880 5520 w
(\347)2880 5620 w
(\347)2880 5720 w
(\347)2880 5820 w
(\347)2880 5920 w
(\347)2880 6020 w
(\347)2880 6120 w
8 PA f
( of the rectangle is drawn)5 923( Some)1 240( a rectangle \(for example a character\) in a layer.)9 1721( Drawing)1 360(Figure 4.)1 316 5 1480 6756 t
( portion of the rectangle overlapping layer)6 1496( The)1 173( screen, some in the obscured parts of the layer.)9 1670(on the)1 221 4 1480 6876 t
(A is drawn in the obscured bitmap, not on the screen.)10 1885 1 1480 6996 t
cleartomark
showpage
saveobj restore
%%EndPage: 9 11
%%Page: 10 12
/saveobj save def
mark
12 pagesetup
10 PA f
(- 10 -)2 216 1 2772 480 t
( example, consider drawing a character \(the hashed rectangle\) in Layer B in Figure 4.)14 3813(As an)1 257 2 970 840 t
(The first call to)3 671 1 720 960 t
10 CW f
(Rlayerop\(\))1420 960 w
10 PA f
(has)2049 960 w
10 CW f
(op)2228 960 w
10 PA f
( of layer B.)3 481(set to the obscured, off-screen, element)5 1736 2 2377 960 t
10 CW f
(op)4647 960 w
10 PA f
(is not)1 245 1 4795 960 t
10 CW f
(NULL)720 1080 w
10 PA f
(, nor is the overlap of)5 939 1 960 1080 t
10 CW f
(r)1924 1080 w
10 PA f
(and)2009 1080 w
10 CW f
(rp->rect)2203 1080 w
10 PA f
( the last block of the large)6 1138(, so we fall into)4 669 2 2683 1080 t
10 HB f
(if)4516 1080 w
10 PA f
(-)4577 1080 w
10 HB f
(else)4610 1080 w
10 PA f
(: part)1 234 1 4806 1080 t
( test)1 181( The)1 217(of the rectangle must be drawn in this obscured bitmap.)9 2470 3 720 1200 t
10 CW f
(if\(r.origin.x < op->bmap->rect.origin.x\))2 2400 1 1080 1380 t
10 PA f
( the right portion of the rectangle \(to the right of Layer A\) is cut off and passed on to)19 3782(succeeds, so)1 538 2 720 1560 t
(a second invocation of)3 997 1 720 1680 t
10 CW f
(Rlayerop\(\))1745 1680 w
10 PA f
( the first)2 372(. Here,)1 322 2 2345 1680 t
10 CW f
(if)3066 1680 w
10 PA f
(statement succeeds, the visible portion of)5 1827 1 3213 1680 t
( and)1 206(the rectangle is drawn on the screen,)6 1681 2 720 1800 t
10 CW f
(Rlayerop)2644 1800 w
10 PA f
( further)1 349( No)1 200(returns to its first invocation.)4 1330 3 3161 1800 t
( rectangle is drawn in the obscured bitmap and the)9 2293(clipping is required, so the left portion of the)8 2027 2 720 1920 t
(job is complete.)2 684 1 720 2040 t
(Although it is a complicated operation,)5 1844 1 970 2196 t
10 CW f
(layerop\(\))2863 2196 w
10 PA f
(is fast compared to the expensive)5 1588 1 3452 2196 t
( When)1 318(graphics operations it invokes.)3 1367 2 720 2316 t
10 CW f
(layerop\(\))2434 2316 w
10 PA f
(is called, its overhead is usually unimportant.)6 2037 1 3003 2316 t
(This is because the data structures to manipulate layers were explicitly designed to make)13 3953 1 720 2436 t
10 PI f
(drawing)4701 2436 w
10 PA f
( common inter-layer)2 924( less)1 198( The)1 229(as rapid as possible, because that is the most common operation.)10 2969 4 720 2556 t
( and deleting layers are slower, but their price is still reasonable,)11 2929(manipulations such as creating)3 1391 2 720 2676 t
(considering how relatively infrequently they are invoked.)6 2553 1 720 2796 t
10 PB f
(Upfront)720 3036 w
10 PA f
( principle be applied to layers: changing)6 1852(There are three basic transformations that can in)7 2218 2 970 3192 t
( of a layer \(scaling\); changing the position of a layer on the screen \(translation\);)14 3634(the dimensions)1 686 2 720 3312 t
(and changing the front-to-back positions of overlapping layers \(stacking\).)8 3251 1 720 3432 t
( \320 changing a layer's size, as distinct from changing the scale of the)13 3139(The issues of scaling)3 931 2 970 3588 t
( \320 and translation are not handled at all by the layer soft-)12 2711(coordinate systems inside the layer)4 1609 2 720 3708 t
( makes them difficult to)4 1126(ware, primarily because the subdivided nature of the data structures)9 3194 2 720 3828 t
( important transformations.)2 1261( is not to say that scaling and translation are not)10 2295(implement. This)1 764 3 720 3948 t
( a new layer at the desti-)6 1104(Translation services in particular must be provided, perhaps by creating)9 3216 2 720 4068 t
(nation position, using)2 974 1 720 4188 t
10 CW f
(lbitblt\(\))1724 4188 w
10 PA f
(\(the generalized)1 719 1 2294 4188 t
10 CW f
(bitblt\(\))3043 4188 w
10 PA f
(operator, discussed later\) to copy)4 1487 1 3553 4188 t
( that the)2 385( Note)1 280(the data to the new position, and deleting the old layer.)10 2558 3 720 4308 t
10 PI f
(data)3980 4308 w
10 PA f
(in the layer can be)4 852 1 4188 4308 t
( the screen, using an auxiliary bitmap to hold the data obscured by)12 3055(dragged dynamically across)2 1265 2 720 4428 t
( rectangular outline, without dynamically and)5 2155(the dragged rectangle or even just dragging a)7 2165 2 720 4548 t
( relative complexity of the subdi-)5 1539( the)1 181( Given)1 334(incrementally modifying the layer data structure.)5 2266 4 720 4668 t
( \(it is the way our)5 794(vided layer structure, this approach is more reasonable, and certainly adequate)10 3526 2 720 4788 t
( than signalling the)3 855( notion of copying the data rather)6 1504( The)1 220(higher-level software does translation\).)3 1741 4 720 4908 t
( model: the application program is)5 1567(application program to recreate it is consistent with the layer)9 2753 2 720 5028 t
( the layers on the)4 788(freed from the responsibility of maintaining its layer during rearrangement of)10 3532 2 720 5148 t
(screen.)720 5268 w
( the)1 168( there is no display list,)5 1036( Because)1 406(Scaling, however, does not fit as well into the software.)9 2460 4 970 5424 t
( by the lower-level software \320 at)6 1531(data in the different-sized layer cannot be recreated perfectly)8 2789 2 720 5544 t
( have no solution)3 767( We)1 200( of the source and destination layers can be maintained.)9 2473(best, an intersection)2 880 4 720 5664 t
( it as critical; the importance of the extended bitmap idea is pow-)12 2862(to this problem, but don't regard)5 1458 2 720 5784 t
( to give up low-level support for scaling rather than revert to display)12 3089(erful enough that we prefer)4 1231 2 720 5904 t
( a)1 81( Does)1 278( a window or a viewport.)5 1148( it is unclear whether a layer should be regarded as)10 2327(lists. Also,)1 486 5 720 6024 t
( at a different scale or a different-sized portion of the)10 2437(different-sized layer show the same thing)5 1883 2 720 6144 t
( contains a picture composed of incompressible bitmaps,)7 2498( example, if a large layer)5 1088( For)1 202(same thing?)1 532 4 720 6264 t
( a text editor, what should happen to the image if the layer is)13 2896(such as a page of characters in)6 1424 2 720 6384 t
( particular, should the same configuration of smaller characters be)9 3094( In)1 161(shrunk to half its size?)4 1065 3 720 6504 t
( and)1 207( could be correct under some conditions,)6 1867( Either)1 331(drawn, or fewer characters the same size?)6 1915 4 720 6624 t
(rather than make a decision we chose to ignore the issue.)10 2513 1 720 6744 t
( rearrangement)1 689(Any stacking transformation can be defined as a sequential set of one-layer)11 3381 2 970 6900 t
( single layer to another position, such as the front or back of the stack of lay-)16 3379(operations, moving a)2 941 2 720 7020 t
( deck of)2 371( example, the stack can be inverted by an action similar to counting through a)14 3582(ers. For)1 367 3 720 7140 t
(cards.)720 7260 w
10 CW f
(upfront\(\))1062 7260 w
10 PA f
( of the stack, making it)5 1146(is an operator that moves a layer to the front)9 2237 2 1657 7260 t
cleartomark
showpage
saveobj restore
%%EndPage: 10 12
%%Page: 11 13
/saveobj save def
mark
13 pagesetup
10 PA f
(- 11 -)2 216 1 2772 480 t
( because in the couple of)5 1102( is the only stacking operator in the layer software,)9 2267( It)1 120(completely visible.)1 831 4 720 840 t
( effect can be achieved, with acceptable)6 1739(places where a different operation is required, the desired)8 2581 2 720 960 t
(efficiency, by calls to)3 915 1 720 1080 t
10 CW f
(upfront\(\))1660 1080 w
10 PA f
( action of pulling a layer to the front was chosen because it)12 2598(. The)1 242 2 2200 1080 t
( the)1 187( something interesting happens in a partially obscured layer,)8 2875( When)1 338(is the most natural.)3 920 4 720 1200 t
( it can be studied.)4 780(instinctive reaction is to pull the layer to the front where)10 2488 2 720 1320 t
10 CW f
(upfront\(\))4039 1320 w
10 PA f
(also turns)1 435 1 4605 1320 t
(out to be a useful operation during the creation and deletion of layers.)12 3097 1 720 1440 t
(After Before)1 -1541 1 3664 3585 t
(Layer B)1 341 1 3880 2739 t
(Layer A)1 358 1 3421 2109 t
4122 1560 4140 1569 Dl
4140 1569 4122 1578 Dl
3960 1569 3978 1569 Dl
3979 1569 4050 1560 Dl
4050 1560 4050 1578 Dl
4050 1578 4122 1569 Dl
4122 1569 4140 1569 Dl
10 S1 f
(_ ___)1 180 1 4140 1569 t
10 S f
(\347)4140 1929 w
(\347)4140 1869 w
(\347)4140 1769 w
(\347)4140 1669 w
10 S1 f
(_ ___)1 180 1 4140 1929 t
10 S f
(\347)4320 1669 w
(\347)4320 1729 w
(\347)4320 1829 w
(\347)4320 1929 w
3240 1583 3240 1569 Dl
3240 1640 3240 1626 Dl
3240 1655 3240 1641 Dl
3240 1712 3240 1698 Dl
3240 1727 3240 1713 Dl
3240 1784 3240 1770 Dl
3240 1799 3240 1785 Dl
3240 1856 3240 1842 Dl
3240 1871 3240 1857 Dl
3240 1928 3240 1914 Dl
3240 1943 3240 1929 Dl
3240 2000 3240 1986 Dl
3240 2015 3240 2001 Dl
3240 2072 3240 2058 Dl
3240 2087 3240 2073 Dl
3240 2144 3240 2130 Dl
3240 2159 3240 2145 Dl
3240 2216 3240 2202 Dl
3240 2231 3240 2217 Dl
3240 2288 3240 2274 Dl
3240 2303 3240 2289 Dl
3240 2360 3240 2346 Dl
3240 2375 3240 2361 Dl
3240 2432 3240 2418 Dl
3240 2447 3240 2433 Dl
3240 2504 3240 2490 Dl
3240 2519 3240 2505 Dl
3240 2576 3240 2562 Dl
3240 2591 3240 2577 Dl
3240 2648 3240 2634 Dl
3255 2649 3240 2649 Dl
3319 2649 3304 2649 Dl
3335 2649 3319 2649 Dl
3399 2649 3384 2649 Dl
3415 2649 3399 2649 Dl
3479 2649 3463 2649 Dl
3495 2649 3480 2649 Dl
3559 2649 3543 2649 Dl
3575 2649 3560 2649 Dl
3639 2649 3624 2649 Dl
3656 2649 3640 2649 Dl
3719 2649 3704 2649 Dl
3736 2649 3720 2649 Dl
3800 2649 3784 2649 Dl
3815 2649 3800 2649 Dl
3880 2649 3864 2649 Dl
3895 2649 3880 2649 Dl
3959 2649 3944 2649 Dl
3960 2635 3960 2649 Dl
3960 2577 3960 2591 Dl
3960 2563 3960 2577 Dl
3960 2505 3960 2519 Dl
3960 2491 3960 2505 Dl
3960 2433 3960 2447 Dl
3960 2419 3960 2433 Dl
3960 2361 3960 2375 Dl
3960 2347 3960 2361 Dl
3960 2289 3960 2303 Dl
3960 2275 3960 2289 Dl
3960 2217 3960 2231 Dl
3960 2203 3960 2217 Dl
3960 2145 3960 2159 Dl
3960 2131 3960 2145 Dl
3960 2073 3960 2087 Dl
3960 2059 3960 2073 Dl
3960 2001 3960 2015 Dl
3960 1987 3960 2001 Dl
3960 1929 3960 1943 Dl
3960 1915 3960 1929 Dl
3960 1857 3960 1871 Dl
3960 1843 3960 1857 Dl
3960 1785 3960 1799 Dl
3960 1771 3960 1785 Dl
3960 1713 3960 1727 Dl
3960 1699 3960 1713 Dl
3960 1641 3960 1655 Dl
3960 1627 3960 1641 Dl
3960 1569 3960 1583 Dl
3945 1569 3960 1569 Dl
3880 1569 3895 1569 Dl
3864 1569 3880 1569 Dl
3801 1569 3816 1569 Dl
3784 1569 3800 1569 Dl
3720 1569 3736 1569 Dl
3705 1569 3720 1569 Dl
3640 1569 3656 1569 Dl
3625 1569 3640 1569 Dl
3561 1569 3576 1569 Dl
3544 1569 3560 1569 Dl
3481 1569 3496 1569 Dl
3464 1569 3480 1569 Dl
3400 1569 3416 1569 Dl
3384 1569 3399 1569 Dl
3320 1569 3336 1569 Dl
3304 1569 3319 1569 Dl
3240 1569 3255 1569 Dl
10 S1 f
(_ __________)1 540 1 3780 2289 t
10 S f
(\347)3780 3189 w
(\347)3780 3089 w
(\347)3780 2989 w
(\347)3780 2889 w
(\347)3780 2789 w
(\347)3780 2689 w
(\347)3780 2589 w
(\347)3780 2489 w
(\347)3780 2389 w
10 S1 f
(_ __________)1 540 1 3780 3189 t
10 S f
(\347)4320 2389 w
(\347)4320 2489 w
(\347)4320 2589 w
(\347)4320 2689 w
(\347)4320 2789 w
(\347)4320 2889 w
(\347)4320 2989 w
(\347)4320 3089 w
(\347)4320 3189 w
10 S1 f
(_ ______________)1 720 1 3240 1569 t
10 S f
(\347)3240 2649 w
(\347)3240 2569 w
(\347)3240 2469 w
(\347)3240 2369 w
(\347)3240 2269 w
(\347)3240 2169 w
(\347)3240 2069 w
(\347)3240 1969 w
(\347)3240 1869 w
(\347)3240 1769 w
(\347)3240 1669 w
10 S1 f
(_ __________)1 540 1 3240 2649 t
10 S f
(\347)3960 1669 w
(\347)3960 1689 w
(\347)3960 1789 w
(\347)3960 1889 w
(\347)3960 1989 w
(\347)3960 2089 w
(\347)3960 2189 w
(\347)3960 2289 w
2682 3180 2700 3189 Dl
2700 3189 2682 3198 Dl
2520 3189 2538 3189 Dl
2538 3189 2610 3180 Dl
2610 3180 2610 3198 Dl
2611 3198 2682 3189 Dl
2682 3189 2700 3189 Dl
10 S1 f
(_ ___)1 180 1 2700 3189 t
10 S f
(\347)2700 3549 w
(\347)2700 3489 w
(\347)2700 3389 w
(\347)2700 3289 w
10 S1 f
(_ ___)1 180 1 2700 3549 t
10 S f
(\347)2880 3289 w
(\347)2880 3349 w
(\347)2880 3449 w
(\347)2880 3549 w
1980 2304 1980 2289 Dl
1980 2363 1980 2349 Dl
1980 2378 1980 2363 Dl
1980 2439 1980 2424 Dl
1980 2453 1980 2439 Dl
1980 2514 1980 2499 Dl
1980 2529 1980 2514 Dl
1980 2588 1980 2574 Dl
1980 2603 1980 2588 Dl
1980 2664 1980 2649 Dl
1980 2678 1980 2664 Dl
1980 2739 1980 2724 Dl
1980 2754 1980 2739 Dl
1980 2813 1980 2799 Dl
1980 2829 1980 2814 Dl
1980 2889 1980 2874 Dl
1980 2903 1980 2889 Dl
1980 2964 1980 2949 Dl
1980 2979 1980 2964 Dl
1980 3038 1980 3024 Dl
1980 3054 1980 3039 Dl
1980 3114 1980 3099 Dl
1980 3128 1980 3114 Dl
1980 3189 1980 3174 Dl
1995 3189 1980 3189 Dl
2056 3189 2041 3189 Dl
2072 3189 2057 3189 Dl
2133 3189 2118 3189 Dl
2149 3189 2134 3189 Dl
2211 3189 2196 3189 Dl
2226 3189 2211 3189 Dl
2288 3189 2273 3189 Dl
2303 3189 2288 3189 Dl
2365 3189 2350 3189 Dl
2380 3189 2365 3189 Dl
2442 3189 2427 3189 Dl
2457 3189 2442 3189 Dl
2519 3189 2504 3189 Dl
2520 3174 2520 3189 Dl
2520 3115 2520 3129 Dl
2520 3099 2520 3114 Dl
2520 3039 2520 3054 Dl
2520 3025 2520 3039 Dl
2520 2964 2520 2979 Dl
2520 2949 2520 2964 Dl
2520 2890 2520 2904 Dl
2520 2874 2520 2889 Dl
2520 2814 2520 2829 Dl
2520 2800 2520 2814 Dl
2520 2739 2520 2754 Dl
2520 2724 2520 2739 Dl
2520 2665 2520 2679 Dl
2520 2649 2520 2664 Dl
2520 2589 2520 2604 Dl
2520 2574 2520 2588 Dl
2520 2514 2520 2529 Dl
2520 2499 2520 2514 Dl
2520 2440 2520 2454 Dl
2520 2424 2520 2439 Dl
2520 2364 2520 2379 Dl
2520 2349 2520 2363 Dl
2520 2288 2520 2303 Dl
2505 2289 2520 2289 Dl
2443 2289 2458 2289 Dl
2427 2289 2442 2289 Dl
2366 2289 2381 2289 Dl
2350 2289 2365 2289 Dl
2289 2289 2304 2289 Dl
2273 2289 2288 2289 Dl
2211 2289 2226 2289 Dl
2196 2289 2211 2289 Dl
2134 2289 2149 2289 Dl
2119 2289 2134 2289 Dl
2057 2289 2072 2289 Dl
2042 2289 2057 2289 Dl
1980 2289 1995 2289 Dl
10 S1 f
(_ ______________)1 720 1 1440 1569 t
10 S f
(\347)1440 2649 w
(\347)1440 2569 w
(\347)1440 2469 w
(\347)1440 2369 w
(\347)1440 2269 w
(\347)1440 2169 w
(\347)1440 2069 w
(\347)1440 1969 w
(\347)1440 1869 w
(\347)1440 1769 w
(\347)1440 1669 w
10 S1 f
(_ ______________)1 720 1 1440 2649 t
10 S f
(\347)2160 1669 w
(\347)2160 1749 w
(\347)2160 1849 w
(\347)2160 1949 w
(\347)2160 2049 w
(\347)2160 2149 w
(\347)2160 2249 w
(\347)2160 2349 w
(\347)2160 2449 w
(\347)2160 2549 w
(\347)2160 2649 w
10 S1 f
(_ _______)1 360 1 2160 2289 t
10 S f
(\347)1980 3189 w
(\347)1980 3149 w
(\347)1980 3049 w
(\347)1980 2949 w
(\347)1980 2849 w
(\347)1980 2749 w
10 S1 f
(_ __________)1 540 1 1980 3189 t
10 S f
(\347)2520 2389 w
(\347)2520 2489 w
(\347)2520 2589 w
(\347)2520 2689 w
(\347)2520 2789 w
(\347)2520 2889 w
(\347)2520 2989 w
(\347)2520 3089 w
(\347)2520 3189 w
10 PA f
(Layer B)1 341 1 2080 2739 t
(Layer A)1 358 1 1621 2109 t
8 R f
( a layer to the front requires interchanging its off-screen bitmaps with screen rectangles.)13 2790( Moving)1 293(Figure 5.)1 288 3 1120 3861 t
10 CW f
(upfront\(\))970 4137 w
10 PA f
( of the code is concerned with maintaining the)8 2162( Most)1 290( structure.)1 465(has a simple)2 574 4 1549 4137 t
( basic algorithm is to exchange the obscured rectangles in the layer with those of)14 3591( The)1 220(linked lists.)1 509 3 720 4257 t
( of the obscured bitmap with the screen \(Figure)8 2139(the layer obscuring them, swapping the contents)6 2181 2 720 4377 t
( has the same dimensions before and after the swap, the)10 2777( the obscured rectangle)3 1121(5\). Since)1 422 3 720 4497 t
( not necessary to allocate a new bitmap, we need merely)10 2544(exchange can be done in place, and it is)8 1776 2 720 4617 t
( are marked with the)4 927( rectangles)1 475( Obscured)1 481(link it into the new obscured layer.)6 1552 4 720 4737 t
10 PI f
(frontmost)4181 4737 w
10 PA f
(obscuring)4601 4737 w
(layer for)1 387 1 720 4857 t
10 CW f
(upfront\(\))1143 4857 w
10 PA f
( that occupies the portion of the)6 1474('s benefit: the frontmost layer is the layer)7 1883 2 1683 4857 t
(screen the rectangle would occupy were it at the front.)9 2404 1 720 4977 t
cleartomark
showpage
saveobj restore
%%EndPage: 11 13
%%Page: 12 14
/saveobj save def
mark
14 pagesetup
10 PA f
(- 12 -)2 216 1 2772 480 t
10 CW f
(/*)1080 900 w
(* upfront -- pull layer to the front of the screen)10 3000 1 1140 1020 t
(*/)1140 1140 w
(upfront\(lp\))1080 1260 w
(Layer *lp;)1 600 1 1330 1380 t
({)1080 1500 w
( a layer in front of lp */)7 1560( /*)1 270(Layer *fr;)1 600 3 1330 1620 t
( a layer behind lp */)5 1260( /*)1 210(Layer *beh;)1 660 3 1330 1740 t
(Obscured *op;)1 780 1 1330 1860 t
(for\(fr = each layer in front of lp\){)7 2160 1 1330 2100 t
(for\(op = each obscured portion of lp\){)6 2280 1 1580 2220 t
( fr obscures op */)4 1080( /*)1 230(if\(op->lobs == fr\){)2 1140 3 1830 2340 t
(screenswap\(op->bitmap, op->rect\);)1 1980 1 2080 2460 t
(unlink op from lp;)3 1080 1 2080 2580 t
(link op into fr;)3 960 1 2080 2700 t
(})1830 2820 w
(})1580 2940 w
(})1330 3060 w
(move lp to front of layer list;)6 1860 1 1330 3180 t
(for\(beh = all other Layers from back to front\))8 2760 1 1330 3300 t
(for\(op = each obscured portion of beh\))6 2280 1 1580 3420 t
(if\(lp->rect overlaps op->bmap->rect\))2 2160 1 1830 3540 t
( mark op obscured by lp */)6 1560( /*)1 300(op->lobs = lp;)2 840 3 2080 3660 t
(})1080 3780 w
(screenswap\(\))970 3996 w
10 PA f
( data in the bitmap with the contents of the rectangle on)11 2579(interchanges the)1 737 2 1724 3996 t
( without auxiliary storage, using three calls to)7 2038( is easily implemented,)3 1024( It)1 120(the screen, in place.)3 871 4 720 4116 t
10 CW f
(bit-)4800 4116 w
(blt\(\))720 4236 w
10 PA f
(with function code)2 839 1 1049 4236 t
10 CW f
(XOR)1917 4236 w
10 PA f
( portions)1 402( that because of the fragmentation of the obscured)8 2243(. Note)1 298 3 2097 4236 t
( created, if)2 463(done when a new Layer is)5 1169 2 720 4356 t
10 CW f
(lp->rect)2378 4356 w
10 PA f
(and)2884 4356 w
10 CW f
(op->bmap->rect)3079 4356 w
10 PA f
(intersect, the Layer must)3 1095 1 3945 4356 t
10 PI f
(completely)720 4476 w
10 PA f
( also that it is)4 623( Note)1 279(obscure it.)1 466 3 1185 4476 t
10 CW f
(upfront\(\))2588 4476 w
10 PA f
( rule that the)3 598(which enforces the)2 849 2 3163 4476 t
10 PI f
(frontmost)4646 4476 w
10 PA f
( if these)2 359( Only)1 281( of a second Layer is the Layer marked as obscuring it.)11 2501(Layer obscuring a portion)3 1179 4 720 4596 t
(two Layers are interchanged is the screen updated.)7 2252 1 720 4716 t
(The last loop is required; it is not sufficient to mark obscured rectangles only in the main)16 4070 1 970 4872 t
(loop, because rectangles initially behind)4 1770 1 720 4992 t
10 CW f
(lp)2515 4992 w
10 PA f
(may also need to be marked.)5 1269 1 2660 4992 t
10 PB f
(Dellayer)720 5232 w
10 PA f
( algo-)1 251( The)1 220(It is simpler to delete a Layer than to create one, so we will discuss deletion first.)16 3599 3 970 5388 t
(rithm is easy:)2 590 1 720 5508 t
( now has no obscured pieces, and is a contiguous rectangle on)11 2791( It)1 122( front.)1 274( the layer to the)4 705(1\) Pull)1 428 5 720 5664 t
(the screen.)1 469 1 970 5784 t
( the screen rectangle the background color.)6 1897(2\) Color)1 500 2 720 5940 t
( is now)2 323( storage needed for the obscured portions of the layer)9 2385( All)1 188( the layer to the back.)5 954(3\) Push)1 470 5 720 6096 t
(bound to the layer, since it obscures no other layer.)9 2253 1 970 6216 t
( all storage associated with the layer.)6 1626(4\) Free)1 442 2 720 6372 t
( the layer from the layer list.)6 1248(5\) Unlink)1 558 2 720 6528 t
(A special routine, the opposite of)5 1532 1 970 6684 t
10 CW f
(upfront\(\))2542 6684 w
10 PA f
(, could be written to push the layer to the)9 1958 1 3082 6684 t
(back, but)1 403 1 720 6804 t
10 CW f
(upfront\(\))1148 6804 w
10 PA f
(can be used for the task:)5 1064 1 1713 6804 t
cleartomark
showpage
saveobj restore
%%EndPage: 12 14
%%Page: 13 15
/saveobj save def
mark
15 pagesetup
10 PA f
(- 13 -)2 216 1 2772 480 t
10 CW f
(/*)1080 900 w
(* dellayer -- delete a layer)5 1680 1 1140 1020 t
(*/)1140 1140 w
(dellayer\(lp\))1080 1260 w
(Layer *lp;)1 600 1 1330 1380 t
({)1080 1500 w
(Obscured *op;)1 780 1 1330 1620 t
(upfront\(lp\);)1330 1860 w
(background\(lp->rect\);)1330 1980 w
(/* Push to back using upfront */)6 1920 1 1330 2100 t
(while\(lp not rearmost layer\))3 1680 1 1330 2220 t
(upfront\(rearmost layer\);)1 1440 1 1580 2340 t
(/* Free the storage */)4 1320 1 1330 2460 t
(for\(op = each obscured part of lp\){)6 2100 1 1330 2580 t
(bfree\(op->bmap\);)1580 2700 w
(free\(op\);)1580 2820 w
(})1330 2940 w
(unlink lp from Layer list;)4 1560 1 1330 3060 t
(})1080 3180 w
10 PA f
(Using successive calls to)3 1096 1 970 3396 t
10 CW f
(upfront\(\))2098 3396 w
10 PA f
(to push a layer to the)5 968 1 2670 3396 t
10 PI f
(back)3670 3396 w
10 PA f
(gives the screen a curious)4 1162 1 3878 3396 t
(appearance during the deletion.)3 1427 1 720 3516 t
10 CW f
(dellayer\(\))2202 3516 w
10 PA f
( it seems unnecessary to)4 1080(is so simple, though, that)4 1128 2 2832 3516 t
(give it extra support by providing a more efficient ")9 2313 1 720 3636 t
10 CW f
(downback\(\))3033 3636 w
10 PA f
(" routine.)1 414 1 3633 3636 t
10 CW f
(upfront\(\))4101 3636 w
10 PA f
(does)4671 3636 w
10 PI f
(not)4907 3636 w
10 PA f
( it)1 99(join disconnected obscured bitmaps which could be joined because of the deletion, although)12 4221 2 720 3756 t
( the usually)2 521( difficulty of recognizing which bitmaps can be joined is too high to justify)13 3306(could. The)1 493 3 720 3876 t
( would)1 318( Joining)1 373( execution efficiency that would be gained thereby.)7 2289(small storage compaction and)3 1340 4 720 3996 t
( the obscured lists of the layers contained information about which layer caused)12 3648(be facilitated if)2 672 2 720 4116 t
( retrospect, it)2 592( In)1 148( example, rectangle 2 in Figure 3\).)6 1526(which edge to be cut during creation \(see, for)8 2054 4 720 4236 t
( with an)2 363(would probably have been better to use some form of tree structure for the obscured lists,)15 3957 2 720 4356 t
( element or dividing)3 919(indication at each node of the layer ``responsible'' for creating the obscured)11 3401 2 720 4476 t
(the underlying structure into two or more elements.)7 2300 1 720 4596 t
10 PB f
(Newlayer)720 4836 w
10 PA f
( most difficult layer operation, for it may require modifying)9 2829(Making a new layer is the)5 1241 2 970 4992 t
( creates any new overlaps, the obscured list of the)9 2237( the new layer)3 644( If)1 123(obscured lists of other layers.)4 1316 4 720 5112 t
( must be restructured so that)5 1301(overlapped layer)1 760 2 720 5232 t
10 CW f
(upfront\(\))2812 5232 w
10 PA f
(need not subdivide any rectangles to)5 1657 1 3383 5232 t
( creation routine,)2 777( The)1 229(pull the obscured layer to the front.)6 1638 3 720 5352 t
10 CW f
(newlayer\(\))3400 5352 w
10 PA f
(, pays the price for the)5 1040 1 4000 5352 t
(simplicity of)1 552 1 720 5472 t
10 CW f
(upfront\(\))1297 5472 w
10 PA f
(and)1862 5472 w
10 CW f
(layerop\(\))2056 5472 w
10 PA f
(.)2596 5472 w
(The basic structure of)3 1022 1 970 5628 t
10 CW f
(newlayer\(\))2042 5628 w
10 PA f
(is to build the layer at the back, constructing the)9 2348 1 2692 5628 t
( the obscured rectangles and visible por-)6 1853(obscured list by intersecting the layer's rectangle with)7 2467 2 720 5748 t
( allocating storage for the obscured bitmaps, the layer is pulled)10 2851( After)1 288(tions of the current layers.)4 1181 3 720 5868 t
( new)1 220(to the front, making it contiguous on the screen and forcing the rectangles obscured by the)15 4100 2 720 5988 t
( the screen)2 493( Finally,)1 394( the new layer.)3 687(layer to contain the new storage required by the addition of)10 2746 4 720 6108 t
(rectangle occupied by the new layer is cleared to complete the operation.)11 3220 1 720 6228 t
(Several ancillary routines are used by)5 1739 1 970 6384 t
10 CW f
(newlayer\(\))2751 6384 w
10 PA f
(.)3351 6384 w
10 CW f
(addrect\(\))3443 6384 w
10 PA f
(adds rectangles to the)3 1015 1 4025 6384 t
(obscured list,)1 593 1 720 6504 t
10 CW f
(obs)1343 6504 w
10 PA f
( screen, any)2 527( the new layer is built at the ``back'' of the)10 1894( Since)1 287(, of the new layer.)4 809 4 1523 6504 t
( the screen.)2 568(obscured rectangle of the new layer will be obscured by a layer already on)13 3752 2 720 6624 t
10 CW f
(addrect\(\))720 6744 w
10 PA f
( marked by which layer is currently)6 1668(builds the list of unique obscured rectangles,)6 2071 2 1301 6744 t
( a rectangle is unique, it is sufficient to)8 1789( be sure that)3 575( To)1 177(occupying the screen in each rectangle.)5 1779 4 720 6864 t
( rectangles passed to)3 929( The)1 222( of the rectangle.)3 748(check just the origin point)4 1173 4 720 6984 t
10 CW f
(addrect\(\))3822 6984 w
10 PA f
(are ordered so)2 648 1 4392 6984 t
(that the first layer associated with a particular rectangle occupies the screen in that rectangle.)14 4104 1 720 7104 t
cleartomark
showpage
saveobj restore
%%EndPage: 13 15
%%Page: 14 16
/saveobj save def
mark
16 pagesetup
10 PA f
(- 14 -)2 216 1 2772 480 t
10 CW f
(/*)1080 900 w
(* addrect -- add \(unique\) rectangle to)6 2280 1 1140 1020 t
( list of new layer)4 1080(* obscured)1 920 2 1140 1140 t
(*/)1140 1260 w
( Pointer to obscured list for new layer */)8 2520( /*)1 280(Obscured *obs;)1 840 3 1080 1380 t
(addrect\(r, lp\))1 840 1 1080 1500 t
(Rectangle r;)1 720 1 1330 1620 t
( Layer currently occupying r on screen */)7 2460( /*)1 270(Layer *lp;)1 600 3 1330 1740 t
({)1080 1860 w
(Obscured *op, *newop;)2 1260 1 1330 1980 t
(for\(op = each element of obs\))5 1740 1 1330 2220 t
(if\(op->rect.origin == r.origin\))2 1860 1 1580 2340 t
( Not unique */)3 840(return; /*)1 620 2 1830 2460 t
(newop = new Obscured;)3 1260 1 1330 2580 t
(newop->rect = r;)2 960 1 1330 2700 t
(newop->lobs = lp;)2 1020 1 1330 2820 t
(link newop into obs list;)4 1500 1 1330 2940 t
(})1080 3060 w
10 PA f
(Because it is called once for each rectangle,)7 1928 1 720 3240 t
10 CW f
(addrect\(\))2679 3240 w
10 PA f
( square of)2 448(takes time proportional to the)4 1342 2 3250 3240 t
( since)1 251( But)1 209( obscured rectangles in the new layer.)6 1696(the number of)2 638 4 720 3360 t
10 CW f
(newlayer\(\))3544 3360 w
10 PA f
(will ultimately per-)2 866 1 4174 3360 t
(form a series of expensive)4 1144 1 720 3480 t
10 CW f
(bitblt\(\))1889 3480 w
10 PA f
('s the time taken by the list operations is insignificant.)9 2374 1 2369 3480 t
10 CW f
(addobs\(\))970 3636 w
10 PA f
( subdivision of the obscured rectangles that intersect the new)9 2887(does recursive)1 658 2 1495 3636 t
(layer, calling)1 572 1 720 3756 t
10 CW f
(addrect\(\))1321 3756 w
10 PA f
( is similar to)3 550( It)1 120( overlap is established.)3 1013(when an)1 384 4 1890 3756 t
10 CW f
(layerop\(\))3985 3756 w
10 PA f
(except that)1 487 1 4553 3756 t
( chain along the obscured list, and no special action \(i.e. storage allocation\) is required)14 3850(it does not)2 470 2 720 3876 t
( subdivided pieces are added to the obscured list of a current)11 2759( As)1 176( match exactly.)2 672(if the rectangles)2 713 4 720 3996 t
( the subdivided pieces are also in the)7 1669(layer, the original rectangle must remain in the list until all)10 2651 2 720 4116 t
( pieces must therefore be added)5 1426( New)1 268(list, whereupon it is deleted.)4 1270 3 720 4236 t
10 PI f
(after)3713 4236 w
10 PA f
( When)1 318(the original piece.)2 797 2 3925 4236 t
(the topmost call to)3 820 1 720 4356 t
10 CW f
(addobs\(\))1565 4356 w
10 PA f
(returns, the subdivision \(if any\) is complete, and the return value is)11 2970 1 2070 4356 t
(whether the argument rectangle was subdivided.)5 2178 1 720 4476 t
10 CW f
(newlayer\(\))2949 4476 w
10 PA f
(then removes the original rectan-)4 1465 1 3575 4476 t
(gle from the list if)4 783 1 720 4596 t
10 CW f
(addobs\(\))1528 4596 w
10 PA f
(returns)2033 4596 w
10 CW f
(TRUE)2379 4596 w
10 PA f
(.)2619 4596 w
cleartomark
showpage
saveobj restore
%%EndPage: 14 16
%%Page: 15 17
/saveobj save def
mark
17 pagesetup
10 PA f
(- 15 -)2 216 1 2772 480 t
10 CW f
(/*)1080 900 w
(* addobs -- add obscured rectangle to list, subdividing obscured)9 3840 1 1140 1020 t
( of layers as necessary)4 1380(* portions)1 920 2 1140 1140 t
(*/)1140 1260 w
(boolean)1080 1380 w
(addobs\(op, argr, newr, lp\))3 1560 1 1080 1500 t
(Obscured *op;)1 780 1 1330 1620 t
( Obscured rectangle */)3 1320( /*)1 220(Rectangle argr;)1 900 3 1330 1740 t
( Complete rectangle of new layer */)6 2100( /*)1 220(Rectangle newr;)1 900 3 1330 1860 t
( Layer op belongs to */)5 1380( /*)1 520(Layer *lp;)1 600 3 1330 1980 t
({)1080 2100 w
(Obscured *newop;)1 960 1 1330 2220 t
(Rectangle r;)1 720 1 1330 2340 t
(Bitmap *bp;)1 660 1 1330 2460 t
( argr will be unchanged through addobs\(\) */)7 2580( /*)1 360(r = argr;)2 540 3 1330 2700 t
(if\(rectXrect\(r, newr\)\){)1 1380 1 1330 2820 t
(/* This is much like layerop\(\) */)6 1980 1 1580 2940 t
(if\(r.origin.x < newr.origin.x\){)2 1860 1 1580 3060 t
(Rectangle temp = piece of r left of newr;)8 2460 1 1830 3180 t
(addobs\(op, temp, newr, lp\);)3 1620 1 1830 3300 t
(r.origin.x = newr.origin.x;)2 1620 1 1830 3420 t
(})1580 3540 w
(/* etc. for other three sides */)6 1920 1 1580 3660 t
(/* r is now contained in rectangle of new layer */)10 3000 1 1580 3780 t
( no clip, just bookkeeping */)5 1740( /*)1 280(if\(r == argr\){)2 840 3 1580 3900 t
(addrect\(r, lp\);)1 900 1 1830 4020 t
( No subdivision */)3 1080( /*)1 340(return FALSE;)1 780 3 1830 4140 t
(})1580 4260 w
(addrect\(r, lp\);)1 900 1 1580 4380 t
(})1330 4500 w
(bp = balloc\(r\);)2 900 1 1330 4620 t
(newop = new Obscured;)3 1260 1 1330 4740 t
(/* Copy the subdivided portion of the image */)8 2760 1 1330 4860 t
(bitblt\(op->bmap, r, bp, bp->rect.origin, STORE\);)4 2880 1 1330 4980 t
(newop->bmap = bp;)2 1020 1 1330 5100 t
(newop->rect = r;)2 960 1 1330 5220 t
( Layer lp obscures this part of the new layer */)10 2880( /*)1 350(newop->lobs = lp;)2 1020 3 1330 5340 t
(link op into lp->obs;)3 1260 1 1330 5460 t
( Subdivision */)2 900( /*)1 300(return TRUE;)1 720 3 1330 5580 t
(})1080 5700 w
cleartomark
showpage
saveobj restore
%%EndPage: 15 17
%%Page: 16 18
/saveobj save def
mark
18 pagesetup
10 PA f
(- 16 -)2 216 1 2772 480 t
10 CW f
(newlayer\(\))970 840 w
10 PA f
(is long but straightforward.)3 1220 1 1595 840 t
10 CW f
( obscured list of new layer when at back */)9 2580( /*)1 340(Obscured obs;)1 780 3 1080 1020 t
(/*)1080 1140 w
(* newlayer -- make a new layer in rectangle r of bitmap *bp)12 3540 1 1140 1260 t
(*/)1140 1380 w
(Layer *)1 420 1 1080 1500 t
(newlayer\(bp, r\))1 900 1 1080 1620 t
(Bitmap *bp;)1 660 1 1330 1740 t
(Rectangle r;)1 720 1 1330 1860 t
({)1080 1980 w
(Layer *lp, *newlp;)2 1080 1 1330 2100 t
(Obscured *op;)1 780 1 1330 2220 t
(/* First build, in obs, a list of all obscured rectangles that)11 3720 1 1330 2460 t
(* will be obscured by the new layer, doing subdivision with)10 3540 1 1390 2580 t
(* addobs\(\))1 600 1 1390 2700 t
(*/)1390 2820 w
(obs = NULL;)2 660 1 1330 2940 t
(for\(lp = each layer from front to back\){)7 2400 1 1330 3060 t
(for\(op = each obscured portion of lp\){)6 2280 1 1580 3180 t
(if\(rectXrect\(r, op->rect\) &&)2 1680 1 1830 3300 t
(addobs\(op, op->rect, r, lp\)\){)3 1740 1 2010 3420 t
(unlink op from lp->obs;)3 1380 1 2080 3540 t
(bfree\(op->bmap\);)2080 3660 w
(free\(op\);)2080 3780 w
(})1830 3900 w
(})1580 4020 w
(})1330 4140 w
(/* Now add the rectangles not currently obscured, but that will)10 3780 1 1330 4260 t
(* be obscured by new layer, by building layer & calling layerop\(\))11 3900 1 1390 4380 t
(*/)1390 4500 w
(newlp = new Layer;)3 1080 1 1330 4620 t
(Bitmap part of newlp = *bp;)5 1620 1 1330 4740 t
( currently obscured ... */)4 1560( /*)1 350(newlp->obs = obs;)2 1020 3 1330 4860 t
(for\(lp = each layer from front to back\))7 2340 1 1330 4980 t
(layerop\(lp, addpiece, lp->rect\);)2 1920 1 1580 5100 t
( ... and soon to be */)6 1320( /*)1 350(newlp->obs = obs;)2 1020 3 1330 5220 t
(for\(op = each element of obs\))5 1740 1 1330 5340 t
(op->bmap = balloc\(op->rect\);)2 1680 1 1580 5460 t
(link newlp into back of layer list;)6 2100 1 1330 5580 t
(upfront\(newlp\);)1330 5700 w
(rectf\(newlp->rect, CLR\); /* Clear the screen rectangle */)7 3420 1 1330 5820 t
(return newlp;)1 780 1 1330 5940 t
(})1080 6060 w
cleartomark
showpage
saveobj restore
%%EndPage: 16 18
%%Page: 17 19
/saveobj save def
mark
19 pagesetup
10 PA f
(- 17 -)2 216 1 2772 480 t
10 CW f
(newlayer\(\))970 840 w
10 PA f
(takes an argument)2 836 1 1602 840 t
10 CW f
(Bitmap)2471 840 w
10 PA f
(, which is typically the screen)5 1338 1 2831 840 t
10 CW f
(Bitmap display)1 813 1 4202 840 t
10 PA f
(,)5015 840 w
( Bitmaps to Lay-)3 735( is a simple \(untried\) generalization from Layers within)8 2480( It)1 121(but may be any other.)4 984 4 720 960 t
(ers within Layers, and a true hierarchy.)6 1740 1 720 1080 t
10 CW f
(addpiece\(\))970 1236 w
10 PA f
( the obscured list the rectangles that are currently)8 2216(is a trivial routine to add to)6 1226 2 1598 1236 t
(unobscured \(i.e. have only one layer\) but that will be obscured by the new layer.)14 3547 1 720 1356 t
10 CW f
(addpiece\(lp, r, bp, otherargs, op\))4 2040 1 1080 1536 t
(Layer *lp;)1 600 1 1330 1656 t
(Rectangle r;)1 720 1 1330 1776 t
(Bitmap *bp;)1 660 1 1330 1896 t
( Unused */)2 600( /*)1 160(char *otherargs;)1 960 3 1330 2016 t
(Obscured *op;)1 780 1 1330 2136 t
({)1080 2256 w
( This piece occupied by one layer only */)8 2460( /*)1 280(if\(op == NULL\))2 840 3 1330 2376 t
(addrect\(r, lp\);)1 900 1 1580 2496 t
(/* Otherwise it's already in obs list */)7 2400 1 1330 2616 t
(})1080 2736 w
10 PB f
(Scrolling and the general)3 1146 1 720 3072 t
10 HB f
(bitblt)1891 3072 w
10 PB f
(operator)2160 3072 w
10 PA f
(So far, we have only discussed)5 1376 1 970 3228 t
10 PI f
(support)2376 3228 w
10 PA f
( This)1 246(for graphics, not graphical actions themselves.)5 2077 2 2717 3228 t
( illustrate how difficult graphics can be on a)8 1993(and the next section, on scrolling and line drawing,)8 2327 2 720 3348 t
(bitmap display, and how)3 1107 1 720 3468 t
10 CW f
(layerop\(\))1852 3468 w
10 PA f
(helps.)2417 3468 w
( example the case of scrolling a layer:)7 1739(For simplicity of exposition, this section uses as an)8 2331 2 970 3624 t
( subdivision of rectangles can get complicated in sophisticated examples, the issues)11 3749(although the)1 571 2 720 3744 t
( harder to imple-)3 789( the general case is not significantly)6 1643( Since)1 295(are all addressed by a simple case.)6 1593 4 720 3864 t
(ment, this section presents a general)5 1673 1 720 3984 t
10 CW f
(lbitblt\(\))2432 3984 w
10 PA f
(operator that extends the bitmap-level)4 1750 1 3011 3984 t
10 CW f
(bit-)4800 3984 w
(blt\(\))720 4104 w
10 PA f
(functionality to layers.)2 995 1 1045 4104 t
(Scrolling a layer \320 moving a layer full of text up one line \320 is a special case of a bitblt)20 4070 1 970 4260 t
( a screen rectangle)3 811(operation. Scrolling)1 896 2 720 4380 t
10 CW f
(r)2452 4380 w
10 PA f
(is a single bitblt:)3 717 1 2537 4380 t
10 CW f
(#define NLSZ 16 /* height of a text line */)9 2580 1 1080 4560 t
(bitblt\(display, Rect\(r.origin, Pt\(r.corner.x, r.corner.y-NLSZ\)\),)3 3840 1 1080 4680 t
(display, Pt\(r.origin.x, r.origin.y+NLSZ\), STORE\);)3 2940 1 1330 4800 t
10 PA f
( text up one line.)4 804(that copies all but the first line of)7 1563 2 720 4980 t
10 CW f
(Rect\(\))3154 4980 w
10 PA f
(and)3556 4980 w
10 CW f
(Pt\(\))3767 4980 w
10 PA f
(create Rectangles and)2 991 1 4049 4980 t
( a layer requires a series of bitblts, which must also be)11 2538( Scrolling)1 458(Points from their arguments.)3 1324 3 720 5100 t
( 6 illustrates a simple example of scrolling a partially obscured)10 2887( Figure)1 352( a certain order.)3 735(done in)1 346 4 720 5220 t
( three bitblts, so that the source and destination rectangles each lie)11 2943( scroll is broken into)4 909(layer. The)1 468 3 720 5340 t
(within a single bitmap.)3 1017 1 720 5460 t
(The routine)1 515 1 970 5616 t
10 CW f
(lbitblt\(\))1510 5616 w
10 PA f
(has semantics identical to)3 1131 1 2075 5616 t
10 CW f
(bitblt\(\))3232 5616 w
10 PA f
(, but accepts Layer arguments)4 1328 1 3712 5616 t
( as Bitmaps, and does the necessary subdivision of obscured rectangles and executes the)13 4004(as well)1 316 2 720 5736 t
(atomic)720 5856 w
10 CW f
(bitblt\(\))1060 5856 w
10 PA f
( two basic methods to organize)5 1460( are)1 179( There)1 321(calls in the correct order.)4 1157 4 1581 5856 t
10 CW f
(lbit-)4740 5856 w
(blt\(\))720 5976 w
10 PA f
( first method calls)3 828(. The)1 255 2 1020 5976 t
10 CW f
(layerop\(\))2141 5976 w
10 PA f
(to create a list of source rectangles by dividing the)9 2321 1 2719 5976 t
( in Figure 6, with \(A+B\) off-screen and \(C+D\) visible\) into a set of)13 3062(original rectangle \(\(B+C+D\))2 1258 2 720 6096 t
( within single bitmaps.)3 1030(rectangles contained)1 917 2 720 6216 t
10 CW f
(layerop)2724 6216 w
10 PA f
(is then called for each source rectangle to)7 1864 1 3176 6216 t
( also contained in single bitmaps \(separating C and)8 2313(subdivide it so the destination rectangles are)6 2007 2 720 6336 t
( has the disadvantage that it calls)6 1517( This)1 249( d\).)1 153(D in Figure 6 because c is in a different bitmap from)11 2401 4 720 6456 t
10 CW f
(layerop\(\))720 6576 w
10 PA f
( although simpler, faster code can accomplish the)7 2312(once for each source rectangle,)4 1425 2 1303 6576 t
(task.)720 6696 w
( we use, calls)3 626(The second method, and the one)5 1517 2 970 6852 t
10 CW f
(layerop\(\))3155 6852 w
10 PA f
(twice: once to subdivide the)4 1303 1 3737 6852 t
( loop to intersect the)4 977( The)1 236( rectangles.)1 517(source rectangles and once to subdivide the destination)7 2590 4 720 6972 t
(source and destination rectangles is then trivial.)6 2111 1 720 7092 t
10 CW f
(lbitblt\(\))970 7248 w
10 PA f
(uses the defined type ListElement to couple the bitmaps to the rectangles:)11 3251 1 1535 7248 t
cleartomark
showpage
saveobj restore
%%EndPage: 17 19
%%Page: 18 20
/saveobj save def
mark
20 pagesetup
10 PA f
(- 18 -)2 216 1 2772 480 t
3221 1787 3291 1745 Dl
3290 1744 3213 1717 Dl
2469 1827 3291 1745 Dl
3221 2075 3291 2033 Dl
3290 2032 3213 2005 Dl
2469 2115 3291 2033 Dl
3221 2198 3291 2156 Dl
3290 2156 3213 2129 Dl
2469 2238 3291 2156 Dl
(b)3675 1786 w
(c)3680 2074 w
(d)3672 2197 w
4096 1992 4114 1992 Dl
4023 1992 4041 1992 Dl
4004 1992 4022 1992 Dl
3931 1992 3949 1992 Dl
3913 1992 3931 1992 Dl
3840 1992 3858 1992 Dl
3821 1992 3839 1992 Dl
3748 1992 3766 1992 Dl
3730 1992 3748 1992 Dl
3657 1992 3675 1992 Dl
3639 1992 3657 1992 Dl
3566 1992 3584 1992 Dl
3547 1992 3565 1992 Dl
3474 1992 3492 1992 Dl
3456 1992 3474 1992 Dl
3383 1992 3401 1992 Dl
3364 1992 3382 1992 Dl
3291 1992 3309 1992 Dl
10 S1 f
(_ ________________)1 822 1 3292 2280 t
3291 1555 3291 1539 Dl
3291 1621 3291 1605 Dl
3291 1637 3291 1621 Dl
3291 1703 3291 1687 Dl
3291 1720 3291 1704 Dl
3291 1785 3291 1769 Dl
3291 1802 3291 1786 Dl
3291 1868 3291 1852 Dl
3291 1884 3291 1868 Dl
3291 1950 3291 1934 Dl
3291 1966 3291 1950 Dl
3291 2032 3291 2016 Dl
3291 2049 3291 2033 Dl
3291 2114 3291 2098 Dl
3291 2131 3291 2115 Dl
3291 2197 3291 2181 Dl
3291 2213 3291 2197 Dl
3291 2279 3291 2263 Dl
3291 2296 3291 2280 Dl
3291 2361 3291 2345 Dl
3309 2362 3291 2362 Dl
3382 2362 3364 2362 Dl
3400 2362 3382 2362 Dl
3474 2362 3456 2362 Dl
3492 2362 3474 2362 Dl
3565 2362 3547 2362 Dl
3583 2362 3565 2362 Dl
3656 2362 3638 2362 Dl
3675 2362 3657 2362 Dl
3748 2362 3730 2362 Dl
3766 2362 3748 2362 Dl
3839 2362 3821 2362 Dl
3857 2362 3839 2362 Dl
3931 2362 3913 2362 Dl
3949 2362 3931 2362 Dl
4022 2362 4004 2362 Dl
4040 2362 4022 2362 Dl
4114 2362 4096 2362 Dl
4114 2346 4114 2362 Dl
4114 2280 4114 2296 Dl
4114 2264 4114 2280 Dl
4114 2198 4114 2214 Dl
4114 2181 4114 2197 Dl
4114 2115 4114 2131 Dl
4114 2099 4114 2115 Dl
4114 2033 4114 2049 Dl
4114 2017 4114 2033 Dl
4114 1951 4114 1967 Dl
4114 1934 4114 1950 Dl
4114 1869 4114 1885 Dl
4114 1852 4114 1868 Dl
4114 1786 4114 1802 Dl
4114 1770 4114 1786 Dl
4114 1704 4114 1720 Dl
4114 1688 4114 1704 Dl
4114 1622 4114 1638 Dl
4114 1605 4114 1621 Dl
4114 1539 4114 1555 Dl
4096 1539 4114 1539 Dl
4023 1539 4041 1539 Dl
4004 1539 4022 1539 Dl
3931 1539 3949 1539 Dl
3913 1539 3931 1539 Dl
3840 1539 3858 1539 Dl
3821 1539 3839 1539 Dl
3748 1539 3766 1539 Dl
3730 1539 3748 1539 Dl
3657 1539 3675 1539 Dl
3639 1539 3657 1539 Dl
3566 1539 3584 1539 Dl
3547 1539 3565 1539 Dl
3474 1539 3492 1539 Dl
3456 1539 3474 1539 Dl
3383 1539 3401 1539 Dl
3364 1539 3382 1539 Dl
3291 1539 3309 1539 Dl
(_ ________________________)1 1234 1 3085 840 t
10 S f
(\347)3085 2074 w
(\347)3085 2040 w
(\347)3085 1940 w
(\347)3085 1840 w
(\347)3085 1740 w
(\347)3085 1640 w
(\347)3085 1540 w
(\347)3085 1440 w
(\347)3085 1340 w
(\347)3085 1240 w
(\347)3085 1140 w
(\347)3085 1040 w
(\347)3085 940 w
10 S1 f
(_ ________________________)1 1234 1 3086 2074 t
10 S f
(\347)4320 940 w
(\347)4320 974 w
(\347)4320 1074 w
(\347)4320 1174 w
(\347)4320 1274 w
(\347)4320 1374 w
(\347)4320 1474 w
(\347)4320 1574 w
(\347)4320 1674 w
(\347)4320 1774 w
(\347)4320 1874 w
(\347)4320 1974 w
(\347)4320 2074 w
(\347)3291 2362 w
(\347)3291 2274 w
(\347)3291 2174 w
10 S1 f
(_ ________________)1 822 1 3292 2362 t
10 S f
(\347)4114 2174 w
(\347)4114 2262 w
(\347)4114 2362 w
10 S1 f
(_ ________________)1 822 1 1646 2156 t
2452 1621 2468 1621 Dl
2386 1621 2402 1621 Dl
2370 1621 2386 1621 Dl
2304 1621 2320 1621 Dl
2288 1621 2304 1621 Dl
2222 1621 2238 1621 Dl
2205 1621 2221 1621 Dl
2139 1621 2155 1621 Dl
2123 1621 2139 1621 Dl
2057 1621 2073 1621 Dl
2041 1621 2057 1621 Dl
1975 1621 1991 1621 Dl
1958 1621 1974 1621 Dl
1893 1621 1909 1621 Dl
1876 1621 1892 1621 Dl
1810 1621 1826 1621 Dl
1794 1621 1810 1621 Dl
1728 1621 1744 1621 Dl
1712 1621 1728 1621 Dl
1646 1621 1662 1621 Dl
1645 1555 1645 1539 Dl
1645 1621 1645 1605 Dl
1645 1637 1645 1621 Dl
1645 1703 1645 1687 Dl
1645 1720 1645 1704 Dl
1645 1785 1645 1769 Dl
1645 1802 1645 1786 Dl
1645 1868 1645 1852 Dl
1645 1884 1645 1868 Dl
1645 1950 1645 1934 Dl
1645 1966 1645 1950 Dl
1645 2032 1645 2016 Dl
1645 2049 1645 2033 Dl
1645 2114 1645 2098 Dl
1645 2131 1645 2115 Dl
1645 2197 1645 2181 Dl
1645 2213 1645 2197 Dl
1645 2279 1645 2263 Dl
1645 2296 1645 2280 Dl
1645 2361 1645 2345 Dl
1661 2362 1645 2362 Dl
1727 2362 1711 2362 Dl
1744 2362 1728 2362 Dl
1809 2362 1793 2362 Dl
1826 2362 1810 2362 Dl
1892 2362 1876 2362 Dl
1908 2362 1892 2362 Dl
1974 2362 1958 2362 Dl
1990 2362 1974 2362 Dl
2056 2362 2040 2362 Dl
2073 2362 2057 2362 Dl
2138 2362 2122 2362 Dl
2155 2362 2139 2362 Dl
2221 2362 2205 2362 Dl
2237 2362 2221 2362 Dl
2303 2362 2287 2362 Dl
2320 2362 2304 2362 Dl
2385 2362 2369 2362 Dl
2402 2362 2386 2362 Dl
2468 2362 2452 2362 Dl
2468 2346 2468 2362 Dl
2468 2280 2468 2296 Dl
2468 2264 2468 2280 Dl
2468 2198 2468 2214 Dl
2468 2181 2468 2197 Dl
2468 2115 2468 2131 Dl
2468 2099 2468 2115 Dl
2468 2033 2468 2049 Dl
2468 2017 2468 2033 Dl
2468 1951 2468 1967 Dl
2468 1934 2468 1950 Dl
2468 1869 2468 1885 Dl
2468 1852 2468 1868 Dl
2468 1786 2468 1802 Dl
2468 1770 2468 1786 Dl
2468 1704 2468 1720 Dl
2468 1688 2468 1704 Dl
2468 1622 2468 1638 Dl
2468 1605 2468 1621 Dl
2468 1539 2468 1555 Dl
2452 1539 2468 1539 Dl
2386 1539 2402 1539 Dl
2370 1539 2386 1539 Dl
2304 1539 2320 1539 Dl
2288 1539 2304 1539 Dl
2222 1539 2238 1539 Dl
2205 1539 2221 1539 Dl
2139 1539 2155 1539 Dl
2123 1539 2139 1539 Dl
2057 1539 2073 1539 Dl
2041 1539 2057 1539 Dl
1975 1539 1991 1539 Dl
1958 1539 1974 1539 Dl
1893 1539 1909 1539 Dl
1876 1539 1892 1539 Dl
1810 1539 1826 1539 Dl
1794 1539 1810 1539 Dl
1728 1539 1744 1539 Dl
1712 1539 1728 1539 Dl
1646 1539 1662 1539 Dl
(_ ________________________)1 1234 1 1440 840 t
10 S f
(\347)1440 2074 w
(\347)1440 2040 w
(\347)1440 1940 w
(\347)1440 1840 w
(\347)1440 1740 w
(\347)1440 1640 w
(\347)1440 1540 w
(\347)1440 1440 w
(\347)1440 1340 w
(\347)1440 1240 w
(\347)1440 1140 w
(\347)1440 1040 w
(\347)1440 940 w
10 S1 f
(_ ________________________)1 1234 1 1440 2074 t
10 S f
(\347)2674 940 w
(\347)2674 974 w
(\347)2674 1074 w
(\347)2674 1174 w
(\347)2674 1274 w
(\347)2674 1374 w
(\347)2674 1474 w
(\347)2674 1574 w
(\347)2674 1674 w
(\347)2674 1774 w
(\347)2674 1874 w
(\347)2674 1974 w
(\347)2674 2074 w
(\347)1645 2362 w
(\347)1645 2274 w
(\347)1645 2174 w
10 S1 f
(_ ________________)1 822 1 1646 2362 t
10 S f
(\347)2468 2174 w
(\347)2468 2262 w
(\347)2468 2362 w
10 PA f
(A)2018 1601 w
(B)2027 1827 w
(C)2022 2156 w
(D)2019 2259 w
8 PA f
( scroll the rear layer, the source rectangles B through D are copied to the destination rectangles b)17 3468( To)1 137(Figure 6.)1 315 3 1120 2638 t
(through d.)1 376 1 1120 2758 t
10 CW f
(typedef struct{)1 900 1 1080 3058 t
(Rectangle rect;)1 900 1 1330 3178 t
(Bitmap *bp;)1 660 1 1330 3298 t
(} ListElement;)1 840 1 1080 3418 t
10 PA f
( calls to)2 344( Two)1 255(The type List chains together ListElements.)5 1933 3 720 3598 t
10 CW f
(layerop\(\))3283 3598 w
10 PA f
( in the coordinate sys-)4 1000(, one)1 217 2 3823 3598 t
( the lists of rectan-)4 816(tem of the source Layer and one in the coordinates of the destination, generate)13 3504 2 720 3718 t
( simple nested loop then executes the component)7 2170( A)1 128(gles in sorted order.)3 885 3 720 3838 t
10 CW f
(bitblt\(\))3928 3838 w
10 PA f
(calls:)4433 3838 w
10 CW f
( difference between source and dest. origin */)7 2760( /*)1 400(Point delta;)1 720 3 1080 4018 t
( list of source rect/bitmap pairs */)6 2160( /*)1 340(List SrcList;)1 780 3 1080 4138 t
( list of destination rect/bitmap pairs */)6 2460( /*)1 280(List DestList;)1 840 3 1080 4258 t
(lbitblt\(sl, rect, dl, pt, f\))4 1680 1 1080 4498 t
(Layer *sl, *dl;)2 900 1 1330 4618 t
(Rectangle rect;)1 900 1 1330 4738 t
(Point pt;)1 540 1 1330 4858 t
(Code f;)1 420 1 1330 4978 t
({)1080 5098 w
(ListElement *s, *d;)2 1140 1 1330 5218 t
(Rectangle r;)1 720 1 1330 5338 t
(delta = pt - rect.origin;)4 1500 1 1330 5578 t
(layerop\(sl, Pass, rect, SrcList\);)3 1980 1 1330 5698 t
(layerop\(dl, Pass, raddp\(rect, delta\), DestList\);)4 2880 1 1330 5818 t
(for\(s = each element of SrcList\))5 1920 1 1330 5938 t
(for\(d = each element of DestList\) {)6 2100 1 1580 6058 t
(r = intersection of d->rect)4 1620 1 1830 6178 t
(and raddp\(s->rect, delta\);)2 1560 1 2080 6298 t
(if\(r not null\))2 840 1 1830 6418 t
(bitblt\(s->bp, rsubp\(r, delta\),)2 1800 1 2080 6538 t
(d->bp, r.origin, f\);)2 1200 1 2330 6658 t
(})1580 6778 w
(})1080 6898 w
(raddp\(\))970 7114 w
10 PA f
(adds its second argument, a)4 1258 1 1421 7114 t
10 CW f
(Point)2710 7114 w
10 PA f
(, to the)2 314 1 3010 7114 t
10 CW f
(origin)3355 7114 w
10 PA f
(and)3746 7114 w
10 CW f
(corner)3946 7114 w
10 PA f
( first argu-)2 480(of its)1 223 2 4337 7114 t
(ment, a)1 344 1 720 7234 t
10 CW f
(Rectangle)1106 7234 w
10 PA f
(;)1646 7234 w
10 CW f
(rsubp\(\))1713 7234 w
10 PA f
(is the corresponding subtraction operator.)4 1929 1 2175 7234 t
10 CW f
(Pass\(\))4170 7234 w
10 PA f
(is a trivial)2 469 1 4571 7234 t
cleartomark
showpage
saveobj restore
%%EndPage: 18 20
%%Page: 19 21
/saveobj save def
mark
21 pagesetup
10 PA f
(- 19 -)2 216 1 2772 480 t
( rectangles in the lists are sorted according to an ordering operator)11 2975( The)1 220(routine to create the lists.)4 1125 3 720 840 t
10 CW f
(lessthan\(\))720 960 w
10 PA f
(.)1320 960 w
10 CW f
(Pass\(lp, r, sb, ap, op\))4 1380 1 1080 1140 t
(/* the usual declarations */)4 1680 1 1330 1260 t
(struct {)1 480 1 1330 1380 t
(List l;)1 420 1 1580 1500 t
(} *fp;)1 360 1 1330 1620 t
({)1080 1740 w
(ListElement *e;)1 900 1 1330 1860 t
(for\(e = each element of fp->l\))5 1800 1 1330 2100 t
(if\(not lessthan\(r, e->rect\)\) {)3 1800 1 1580 2220 t
(insert the ListElement {sb, r} into fp->l)6 2460 1 1830 2340 t
(before e;)1 540 1 2080 2460 t
(return;)1830 2580 w
(})1580 2700 w
(append {sb, r} to fp->l)4 1380 1 1330 2820 t
(})1080 2940 w
(boolean)1080 3180 w
(lessthan\(a, b\))1 840 1 1080 3300 t
(Rectangle a, b;)2 900 1 1330 3420 t
({)1080 3540 w
(if\(\(a->origin.y < b->corner.y\) && \(b->origin.y < a->corner.y\)\))6 3720 1 1330 3660 t
(return \(\(a->origin.x - b->origin.x\)*delta.x\) >= 0;)5 3000 1 1580 3780 t
(else)1330 3900 w
(return \(\(a->origin.y - b->origin.y\)*delta.y\) >= 0;)5 3000 1 1580 4020 t
(})1080 4140 w
10 PA f
( in)1 115(The first test sees if the two rectangles overlap)8 2054 2 720 4320 t
10 PI f
(y,)2917 4320 w
10 PA f
(and if so checks the)4 871 1 3020 4320 t
10 PI f
(x)3919 4320 w
10 PA f
(ordering; otherwise the)2 1043 1 3997 4320 t
10 PI f
(y)720 4440 w
10 PA f
( correct)1 354( ordering of the lists simplifies doing the bitblts in the)10 2628( The)1 243(ordering is sufficient.)2 994 4 821 4440 t
( the scrolling example,)3 1026(sequence. For)1 640 2 720 4560 t
10 CW f
(delta.y)2421 4560 w
10 PA f
(is positive, and)2 689 1 2876 4560 t
10 CW f
(lessthan\(\))3601 4560 w
10 PA f
(orders the rectan-)2 803 1 4237 4560 t
(gles so they are copied in decreasing)6 1615 1 720 4680 t
10 PI f
(y)2360 4680 w
10 PA f
(order \(see Figure 6\).)3 887 1 2435 4680 t
( source and destination bitmaps are distinct in the)8 2284( the)1 173( If)1 126(There are a few efficiency issues.)5 1487 4 970 4836 t
( a layer, the rectangles need not be sorted, but)9 2089(uppermost call, such as in drawing a character in)8 2231 2 720 4956 t
10 CW f
(lbitblt\(\))720 5076 w
10 PA f
( if one or both of the layers has an empty obscured list,)12 2561( Also,)1 291(sorts them anyway.)2 891 3 1297 5076 t
10 CW f
(lbitblt\(\))720 5196 w
10 PA f
(could recognize these degenerate cases and call)6 2153 1 1295 5196 t
10 CW f
(bitblt\(\))3483 5196 w
10 PA f
( neither layer)2 605(directly if)1 437 2 3998 5196 t
(has obscured components, or)3 1291 1 720 5316 t
10 CW f
(lblt\(\))2036 5316 w
10 PA f
(if only one does.)3 727 1 2421 5316 t
(More seriously, the implementation of)4 1701 1 970 5472 t
10 CW f
(lbitblt\(\))2697 5472 w
10 PA f
( code with)2 465(presented here contains some)3 1312 2 3263 5472 t
(quadratic complexity \320 the inner loops of)6 1928 1 720 5592 t
10 CW f
(Pass)2683 5592 w
10 PA f
(and)2958 5592 w
10 CW f
(lbitblt\(\))3162 5592 w
10 PA f
( first method described)3 1053(. \(The)1 285 2 3702 5592 t
(above only executes)2 891 1 720 5712 t
10 PI f
(n)1638 5712 w
10 PA f
(times, but calls)2 661 1 1721 5712 t
10 CW f
(layerop\(\))2409 5712 w
10 PA f
(to \(recursively\) run down the destination lists,)6 2064 1 2976 5712 t
( lists are typically short, so this)6 1421( our application the obscured)4 1340( In)1 153(so the complexity is the same.\))5 1406 4 720 5832 t
(complexity is dwarfed by the expense of the underlying)8 2501 1 720 5952 t
10 CW f
(bitblt\(\))3250 5952 w
10 PA f
( it)1 92( this were not true,)4 849(calls. If)1 340 3 3759 5952 t
(would be straightforward to rewrite both)5 1849 1 720 6072 t
10 CW f
(Pass)2598 6072 w
10 PA f
(and)2867 6072 w
10 CW f
(lbitblt\(\))3065 6072 w
10 PA f
(to use)1 267 1 3634 6072 t
10 PI f
(n)3929 6072 w
10 PA f
(log)3993 6072 w
10 PI f
(n)4141 6072 w
10 PA f
(search algorithms.)1 815 1 4225 6072 t
(The structure of the code would be the same, however, and the use of)13 3199 1 720 6192 t
10 CW f
(layerop\(\))3954 6192 w
10 PA f
(to organize)1 510 1 4530 6192 t
(the clipping would be unaffected.)4 1488 1 720 6312 t
10 PB f
(Lines)720 6552 w
10 PA f
( lines)1 238( Drawing)1 450( a dot-matrix display is an old problem \(see e.g. [new79]\).)10 2608(Drawing lines on)2 774 4 970 6708 t
( is more difficult, because the sequence of dots approximating a line must be indepen-)14 3932(in layers)1 388 2 720 6828 t
( line-)1 225( draw a line efficiently in a partially obscured layer, the)10 2463( To)1 168(dent of the structure of the layer.)6 1464 4 720 6948 t
( endpoints of)2 592(drawing algorithm must draw the line as a set of line segments in bitmaps, but the)15 3728 2 720 7068 t
( points on the actual line being)6 1385(the segments \(which must be in integer coordinates\) might not be)10 2935 2 720 7188 t
( approximated by the same points as two lines,)8 2083( line from \(0,0\) to \(300,100\) is not)7 1456(approximated. A)1 781 3 720 7308 t
cleartomark
showpage
saveobj restore
%%EndPage: 19 21
%%Page: 20 22
/saveobj save def
mark
22 pagesetup
10 PA f
(- 20 -)2 216 1 2772 480 t
( course, if efficiency is not an)6 1363( Of)1 177( to \(300,100\).)2 584(one from \(0,0\) to \(100,33\) and one from \(100,33\))8 2196 4 720 840 t
( be drawn by generating the set of dots for the approximation and, for each dot,)15 3610(issue, lines may)2 710 2 720 960 t
( we will assume that a line segment may be)9 2049( Here)1 284( be drawn.)2 500(deciding in which bitmap it will)5 1487 4 720 1080 t
( and that the problem is)5 1093(drawn efficiently in a bitmap \(which is true on any reasonable display\))11 3227 2 720 1200 t
(one of dividing up the original line.)6 1572 1 720 1320 t
( a digital differential analyzer, or DDA, to reduce)8 2295(Most line-drawing algorithms simulate)3 1775 2 970 1476 t
(the strength of the rational arithmetic in)6 1767 1 720 1596 t
10 PI f
(y)2598 1816 w
10 S f
(=)2672 1816 w
(D)2768 1886 w
10 PI f
(x)2837 1886 w
10 S f
(D)2768 1756 w
10 PI f
(y)2837 1756 w
10 S1 f
(___)2753 1786 w
10 PI f
(x)2912 1816 w
10 S f
(+)2986 1816 w
10 PI f
(y)3057 1816 w
7 PA f
(0)3118 1836 w
10 PA f
( approximate a given line by different sets of)8 2109( DDA's)1 343( Different)1 465(to increments and decrements.)3 1403 4 720 2046 t
( algorithm [bre65] has no multiplications or divisions, and uses only integer)11 3400(points. Bresenham's)1 920 2 720 2166 t
(arithmetic:)720 2286 w
10 CW f
(int e,)1 360 1 1080 2466 t
10 S f
(D)1500 2466 w
10 PI f
(x)1569 2466 w
10 CW f
(,)1619 2466 w
10 S f
(D)1739 2466 w
10 PI f
(y)1808 2466 w
10 CW f
(;)1858 2466 w
(e=2)1080 2586 w
10 S f
(D)1260 2586 w
10 PI f
(y)1329 2586 w
10 CW f
(-)1379 2586 w
10 S f
(D)1439 2586 w
10 PI f
(x)1508 2586 w
10 CW f
(;)1558 2586 w
(for\(i=1; i<)1 660 1 1080 2706 t
10 S f
(D)1740 2706 w
10 PI f
(x)1809 2706 w
10 CW f
(; i++\){)1 420 1 1859 2706 t
(drawpoint\(x, y\);)1 960 1 1330 2826 t
(if\(e>0\){)1330 2946 w
(y++;)1580 3066 w
(e+=2)1580 3186 w
10 S f
(D)1820 3186 w
10 PI f
(y)1889 3186 w
10 CW f
(-2)1939 3186 w
10 S f
(D)2059 3186 w
10 PI f
(x)2128 3186 w
10 CW f
(;)2178 3186 w
(}else)1330 3306 w
(e+=2)1580 3426 w
10 S f
(D)1820 3426 w
10 PI f
(y)1889 3426 w
10 CW f
(;)1939 3426 w
(x++;)1330 3546 w
(})1080 3666 w
10 PA f
( efficiently;)1 499(\(As mentioned earlier, this algorithm is usually implemented)7 2758 2 720 3846 t
10 CW f
(drawpoint\(\))4011 3846 w
10 PA f
(is not a)2 335 1 4705 3846 t
( Here,)1 304(subroutine call, and the constants come out of the loop\).)9 2562 2 720 3966 t
10 CW f
(e)3621 3966 w
10 PA f
(is an \(offset and scaled\) error)5 1325 1 3715 3966 t
( and the approximating points.)4 1406(term that represents the vertical distance between the actual line)9 2914 2 720 4086 t
(Each time the algorithm draws a point,)6 1766 1 720 4206 t
10 CW f
(e)2518 4206 w
10 PA f
( deviation from the actual)4 1164(is adjusted to track the local)5 1266 2 2610 4206 t
(line. When)1 520 1 720 4326 t
10 CW f
(e)1282 4326 w
10 PA f
( actual line is too far above the dots, and the dots are therefore)13 2985(is positive, the)2 671 2 1384 4326 t
(moved up one unit in)4 956 1 720 4446 t
10 PI f
(y)1701 4446 w
10 PA f
(.)1751 4446 w
( passes from obscured bitmap to bitmap in the layer)9 2315(The line algorithm can be restarted as it)7 1755 2 970 4602 t
( value of)2 389(by carrying the)2 683 2 720 4722 t
10 CW f
(e)1821 4722 w
10 PA f
( since)1 250( But)1 208(across the boundary.)2 930 3 1910 4722 t
10 CW f
(layerop)3327 4722 w
10 PA f
(calls the bitmap-level opera-)3 1264 1 3776 4722 t
( a non-deterministic order, a simpler solution is to evaluate)9 2691(tors in)1 290 2 720 4842 t
10 CW f
(e)3735 4842 w
10 PA f
(at the \()2 323 1 3829 4842 t
10 PI f
(x)4160 4842 w
10 PA f
(,)4218 4842 w
10 PI f
(y)4251 4842 w
10 PA f
(\) location where)2 731 1 4309 4842 t
( are)1 175( We)1 210( algorithm in each component bitmap.)5 1749(the line intersects the bitmap, and reset the line)8 2186 4 720 4962 t
(assuming 0)1 518 1 720 5082 t
10 S f
(< D)1 165 1 1287 5082 t
10 PI f
(y /)1 88 1 1460 5082 t
10 S f
(D)1556 5082 w
10 PI f
(x)1625 5082 w
10 S f
(\243)1716 5082 w
10 PA f
( we further assume the real line)6 1501( If)1 135(1, a shallow line of positive slope.)6 1592 3 1812 5082 t
( specify points generated by Bresenham's algorithm.)6 2432( we can analytically)3 931( 0 , 0 \))4 190(passes through \()2 767 4 720 5202 t
(The equation of the actual line is)6 1434 1 720 5322 t
10 PI f
(y)2566 5502 w
10 S f
(D)2624 5502 w
10 PI f
(x)2693 5502 w
10 S f
(-)2767 5502 w
10 PI f
(x)2838 5502 w
10 S f
(D)2896 5502 w
10 PI f
(y)2965 5502 w
10 S f
(=)3039 5502 w
10 PA f
(0 ,)1 83 1 3110 5502 t
(so at a generated point)4 1007 1 720 5682 t
10 PI f
(y)2588 5862 w
10 S f
(D)2646 5862 w
10 PI f
(x)2715 5862 w
10 S f
(-)2789 5862 w
10 PI f
(x)2860 5862 w
10 S f
(D)2918 5862 w
10 PI f
(y)2987 5862 w
10 S f
(=)3061 5862 w
10 PI f
(r)3132 5862 w
10 PA f
(where)720 6042 w
10 PI f
(r)1027 6042 w
10 PA f
( the)1 170(is the residual \320 the deviation from the actual line, measured parallel to)12 3257 2 1096 6042 t
10 PI f
(y)4554 6042 w
10 PA f
(axis. For)1 405 1 4635 6042 t
(computational efficiency,)1 1116 1 720 6162 t
10 CW f
(e)1861 6162 w
10 PA f
(is offset and scaled from)4 1074 1 1946 6162 t
10 PI f
(r)3045 6162 w
10 PA f
(:)3084 6162 w
10 CW f
(e)2479 6342 w
10 S f
(= -)1 126 1 2555 6342 t
10 PA f
(2)2697 6342 w
10 PI f
(r)2755 6342 w
10 S f
(+)2818 6342 w
10 PA f
(2)2889 6342 w
10 S f
(D)2947 6342 w
10 PI f
(y)3016 6342 w
10 S f
(- D)1 132 1 3090 6342 t
10 PI f
(x)3230 6342 w
10 PA f
(\(1\))4924 6342 w
(To minimize)1 560 1 720 6522 t
10 PI f
(r)1305 6522 w
10 PA f
(, we round to calculate)4 1005 1 1344 6522 t
10 PI f
(y)2374 6522 w
10 PA f
(:)2424 6522 w
10 PI f
(y)2510 6787 w
10 S f
(=)2584 6787 w
(\357)2663 6700 w
(\357)2663 6800 w
(\353)2663 6900 w
10 PA f
(2)2874 6857 w
10 S f
(D)2932 6857 w
10 PI f
(x)3001 6857 w
(x)2738 6727 w
10 PA f
(2)2796 6727 w
10 S f
(D)2854 6727 w
10 PI f
(y)2923 6727 w
10 S f
(+ D)1 132 1 2997 6727 t
10 PI f
(x)3137 6727 w
10 S1 f
(_ _________)1 479 1 2723 6757 t
10 S f
(\357)3212 6700 w
(\357)3212 6800 w
(\373)3212 6900 w
10 PA f
(\(2\))4924 6787 w
(implying, as above,)2 861 1 720 7072 t
10 PI f
(r)2572 7252 w
10 S f
(=)2635 7252 w
10 PI f
(y)2706 7252 w
10 S f
(D)2764 7252 w
10 PI f
(x)2833 7252 w
10 S f
(-)2907 7252 w
10 PI f
(x)2978 7252 w
10 S f
(D)3036 7252 w
10 PI f
(y .)1 83 1 3105 7252 t
cleartomark
showpage
saveobj restore
%%EndPage: 20 22
%%Page: 21 23
/saveobj save def
mark
23 pagesetup
10 PA f
(- 21 -)2 216 1 2772 480 t
(Substituting,)720 840 w
10 CW f
(e)2289 1020 w
10 S f
(=)2365 1020 w
10 PA f
(\( 2)1 91 1 2436 1020 t
10 PI f
(x)2535 1020 w
10 S f
(+)2609 1020 w
10 PA f
(2 \))1 91 1 2680 1020 t
10 S f
(D)2787 1020 w
10 PI f
(y)2856 1020 w
10 S f
(-)2930 1020 w
10 PA f
(\( 2)1 91 1 3001 1020 t
10 PI f
(y)3100 1020 w
10 S f
(+)3174 1020 w
10 PA f
(1 \))1 91 1 3245 1020 t
10 S f
(D)3352 1020 w
10 PI f
(x)3421 1020 w
10 PA f
(\(3\))4924 1020 w
(Note that if \()3 563 1 720 1200 t
10 PI f
(x)1291 1200 w
10 PA f
(,)1349 1200 w
10 PI f
(y)1382 1200 w
10 PA f
(\))1440 1200 w
10 S f
(=)1489 1200 w
10 PA f
(\( 0 , 0 \),)4 248 1 1560 1200 t
10 CW f
(e)1833 1200 w
10 S f
(=)1893 1200 w
10 PA f
(2)1964 1200 w
10 S f
(D)2022 1200 w
10 PI f
(y)2091 1200 w
10 S f
(- D)1 132 1 2165 1200 t
10 PI f
(x)2305 1200 w
10 PA f
( 3 can also be derived)5 954( Equation)1 453( algorithm.)1 489(, as in the original)4 789 4 2355 1200 t
( equations 2 and 3, we can break a line into a)11 2015( Given)1 321( vice versa\).)2 529(directly from the algorithm \(and)4 1455 4 720 1320 t
( independently of the layer's configuration by resetting the DDA for)10 3114(set of segments in bitmaps)4 1206 2 720 1440 t
( a)1 79( method generates a unique approximation because the state of the DDA is)12 3368( This)1 245(each segment.)1 628 4 720 1560 t
(strict function of)2 729 1 720 1680 t
10 PI f
(x)1474 1680 w
10 PA f
(.)1524 1680 w
( seg-)1 221( clipping routine \(see [new79]\) that divides the line into)9 2594( The)1 233(One problem remains.)2 1022 4 970 1836 t
( the)1 169( If)1 122(ments individually within bitmaps may clip to a horizontal or a vertical edge of a bitmap.)15 4029 3 720 1956 t
(edge is horizontal, several possible)4 1551 1 720 2076 t
10 PI f
(x)2299 2076 w
10 PA f
( lines are half-)3 634( Because)1 406(values may be chosen \(see Figure 7\).)6 1623 3 2377 2076 t
(open, the desired value is the least)6 1633 1 720 2196 t
10 PI f
(x)2397 2196 w
10 PA f
(such that \()2 499 1 2491 2196 t
10 PI f
(x)2998 2196 w
10 PA f
(,)3056 2196 w
10 PI f
(y)3089 2196 w
10 PA f
( a point on the approximated line, as)7 1745(\) is)1 148 2 3147 2196 t
( can be shown that the desired value is)8 1707( It)1 117(defined by \(1\).)2 640 3 720 2316 t
10 PI f
(x)2488 2581 w
10 S f
(=)2562 2581 w
(\351)2641 2494 w
(\357)2641 2594 w
(\357)2641 2694 w
10 PA f
(2)2851 2651 w
10 S f
(D)2909 2651 w
10 PI f
(y)2978 2651 w
10 PA f
(2)2715 2521 w
10 PI f
(y)2773 2521 w
10 S f
(D)2831 2521 w
10 PI f
(x)2900 2521 w
10 S f
(- D)1 132 1 2974 2521 t
10 PI f
(x)3114 2521 w
10 S1 f
(_ _________)1 479 1 2700 2551 t
10 S f
(\371)3189 2494 w
(\357)3189 2594 w
(\357)3189 2694 w
10 PI f
(.)3246 2581 w
10 PA f
(\(4\))4924 2581 w
3901 2866 3901 2866 3927 2866 Ds
3901 2866 3927 2866 3927 2970 Ds
3927 2866 3927 2970 3927 2970 Ds
(Approx. points)1 672 1 3901 2866 t
(Actual line)1 483 1 4162 2996 t
1649 3939 4110 3049 Dl
(. . .)2 175 1 1476 3887 t
( point)1 260( desired)1 -2187(. . .)2 175 3 4108 3101 t
2356 3101 2356 3101 2879 3101 Ds
2356 3101 2879 3101 2879 3362 Ds
2879 3101 2879 3362 2879 3362 Ds
(Outside Layer)1 632 1 2694 2866 t
(Inside Layer)1 552 1 2734 4279 t
(Edge of Layer)2 619 1 4320 3494 t
10 S1 f
(_ __________)1 523 1 3797 3494 t
(_ _____)1 261 1 3796 2970 t
10 S f
(\347)3796 3232 w
(\347)3796 3171 w
(\347)3796 3071 w
10 S1 f
(_ _____)1 261 1 3797 3232 t
10 S f
(\347)4058 3070 w
(\347)4058 3131 w
(\347)4058 3231 w
10 S1 f
(_ _____)1 261 1 3534 3232 t
10 S f
(\347)3534 3494 w
(\347)3534 3433 w
(\347)3534 3333 w
10 S1 f
(_ _____)1 261 1 3535 3494 t
10 S f
(\347)3796 3332 w
(\347)3796 3393 w
(\347)3796 3493 w
10 S1 f
(_ _____)1 261 1 3272 3232 t
10 S f
(\347)3272 3494 w
(\347)3272 3433 w
(\347)3272 3333 w
10 S1 f
(_ _____)1 261 1 3273 3494 t
10 S f
(\347)3534 3332 w
(\347)3534 3393 w
(\347)3534 3493 w
10 S1 f
(_ _____)1 261 1 3010 3232 t
10 S f
(\347)3010 3494 w
(\347)3010 3433 w
(\347)3010 3333 w
10 S1 f
(_ _____)1 261 1 3011 3494 t
10 S f
(\347)3272 3332 w
(\347)3272 3393 w
(\347)3272 3493 w
10 S1 f
(_ _____)1 261 1 2749 3232 t
10 S f
(\347)2749 3494 w
(\347)2749 3433 w
(\347)2749 3333 w
10 S1 f
(_ _____)1 261 1 2749 3494 t
10 S f
(\347)3010 3332 w
(\347)3010 3393 w
(\347)3010 3493 w
10 S1 f
(_ _____)1 261 1 2487 3494 t
10 S f
(\347)2487 3756 w
(\347)2487 3695 w
(\347)2487 3595 w
10 S1 f
(_ _____)1 261 1 2488 3756 t
10 S f
(\347)2749 3594 w
(\347)2749 3655 w
(\347)2749 3755 w
10 S1 f
(_ _____)1 261 1 2225 3494 t
10 S f
(\347)2225 3756 w
(\347)2225 3695 w
(\347)2225 3595 w
10 S1 f
(_ _____)1 261 1 2226 3756 t
10 S f
(\347)2487 3594 w
(\347)2487 3655 w
(\347)2487 3755 w
10 S1 f
(_ _____)1 261 1 1963 3494 t
10 S f
(\347)1963 3756 w
(\347)1963 3695 w
(\347)1963 3595 w
10 S1 f
(_ _____)1 261 1 1964 3756 t
10 S f
(\347)2225 3594 w
(\347)2225 3655 w
(\347)2225 3755 w
10 S1 f
(_ _____)1 261 1 1701 3756 t
10 S f
(\347)1701 4018 w
(\347)1701 3957 w
(\347)1701 3857 w
10 S1 f
(_ _____)1 261 1 1702 4018 t
10 S f
(\347)1963 3856 w
(\347)1963 3917 w
(\347)1963 4017 w
10 S1 f
(_ __________)1 523 1 1440 3494 t
8 PA f
( must be clipped to the first point outside a layer or bitmap.)12 2099( Lines)1 230(Figure 7.)1 311 3 1120 4555 t
10 PA f
(Turning these equations into working code involves a few obvious transformations to cover)12 4070 1 970 4831 t
( be done carefully, to preserve the half-open prop-)8 2300( transformations must)2 1001( The)1 228(all possible cases.)2 791 4 720 4951 t
( a routine)2 433( Given)1 322(erty of lines.)2 556 3 720 5071 t
10 CW f
(clipline\(\))2061 5071 w
10 PA f
( it,)1 118(which clips a line segment to a bitmap and draws)9 2231 2 2691 5071 t
(using a line-drawer which loads the DDA based on the initial)10 2819 1 720 5191 t
10 PI f
(x)3575 5191 w
10 PA f
(value,)3661 5191 w
10 CW f
(layerop\(\))3964 5191 w
10 PA f
(can control)1 501 1 4539 5191 t
(drawing a line in a layer:)5 1101 1 720 5311 t
cleartomark
showpage
saveobj restore
%%EndPage: 21 23
%%Page: 22 24
/saveobj save def
mark
24 pagesetup
10 PA f
(- 22 -)2 216 1 2772 480 t
10 CW f
(Lline\(lp, r, db, fp, op\))4 1440 1 1080 900 t
(Layer *lp;)1 600 1 1330 1020 t
(Rectangle r;)1 720 1 1330 1140 t
(Bitmap *db;)1 660 1 1330 1260 t
(struct{)1330 1380 w
( Endpoints of complete line */)5 1800( /*)1 340(Point p0, p1;)2 780 3 1580 1500 t
( Function code */)3 1020( /*)1 580(int mode;)1 540 3 1580 1620 t
(}*fp;)1330 1740 w
(Obscured *op;)1 780 1 1330 1860 t
({)1080 1980 w
(clipline\(db, r, fp->p0, fp->p1, fp->mode\);)4 2520 1 1330 2100 t
(})1080 2220 w
(lline\(lp, p, q, f\))3 1080 1 1080 2340 t
(Layer *lp;)1 600 1 1330 2460 t
(Point p, q;)2 660 1 1330 2580 t
(int f;)1 360 1 1330 2700 t
({)1080 2820 w
( Initialize global parameters for line\(\) */)6 2580( /*)1 280(setline\(p, q\);)1 840 3 1330 2940 t
(layerop\(lp, Lline, lp->rect, p, q, f\);)5 2280 1 1330 3060 t
(})1080 3180 w
(setline\(\))970 3396 w
10 PA f
( line, in particular)3 795(initializes the global variables for the)5 1640 2 1537 3396 t
10 S f
(D)4000 3396 w
10 PI f
(x)4069 3396 w
10 PA f
(and)4147 3396 w
10 S f
(D)4344 3396 w
10 PI f
(y)4413 3396 w
10 PA f
(, and canoni-)2 577 1 4463 3396 t
(calizes the line by coordinate transformation so that 0)8 2524 1 720 3516 t
10 S f
(< D)1 165 1 3293 3516 t
10 PI f
(y /)1 88 1 3466 3516 t
10 S f
(D)3562 3516 w
10 PI f
(x)3631 3516 w
10 S f
(\243)3722 3516 w
10 PA f
( line algorithm has)3 887(1. This)1 335 2 3818 3516 t
( non-overlapping bitmaps: the sequence of dots)6 2189(advantages over an unadorned DDA, even for)6 2131 2 720 3636 t
( the line is drawn, and portions of a line may)10 2038(generated is independent of the direction in which)7 2282 2 720 3756 t
( these advantages stem from the DDA being a strict function of)11 2814( Both)1 260(be ``undrawn''.)1 678 3 720 3876 t
10 PI f
(x)4500 3876 w
10 PA f
(, instead of)2 490 1 4550 3876 t
(the distance from the starting point of the line.)8 2051 1 720 3996 t
( can be drawn in layers, but how)7 1513(The point of this section is not that lines)8 1830 2 970 4152 t
10 CW f
(layerop)4348 4152 w
10 PA f
(helps)4803 4152 w
( polygon, spline, etc. \320 and an)6 1428( an object to be drawn \320 line, circle, ellipse,)9 2040( Given)1 329(draw them.)1 523 4 720 4272 t
(operator that can draw the object in a bitmap,)8 2023 1 720 4392 t
10 CW f
(layerop)2769 4392 w
10 PA f
( operator with the clipped)4 1162(will invoke the)2 663 2 3215 4392 t
( bit-)1 181( implementation of the)3 1029( The)1 224(rectangle/bitmap pairs that draw the complete object in a layer.)9 2886 4 720 4512 t
( our application, we build lines out of line seg-)9 2142(map operators can be tuned for performance; in)7 2178 2 720 4632 t
( restartable DDA for maximum speed, but draw arcs and circles as sequences of)13 3716(ments with a)2 604 2 720 4752 t
( circles were important to an application,)6 1857( If)1 125( don't draw them nearly as often.)6 1519(points because we)2 819 4 720 4872 t
(the same sort of DDA restarting could be applied, using)9 2533 1 720 4992 t
10 CW f
(layerop)3285 4992 w
10 PA f
(to define the clipping rectan-)4 1303 1 3737 4992 t
(gles for each component of the circle.)6 1638 1 720 5112 t
10 PB f
(Conclusions)720 5352 w
10 PA f
( day-to-day use on hundreds of ``Blit'' terminals through-)8 2589(The software described here is in)5 1481 2 970 5508 t
( an asynchronous window interface to the multi-programmed Unix sys-)9 3232(out Bell Labs, providing)3 1088 2 720 5628 t
( lists [mey81],)2 626( previous window systems, the layers software does not keep display)10 3144(tem. Unlike)1 550 3 720 5748 t
( [tes81] or restrict graphical operations in any way.)8 2268(force ``repainting'' during window operations)4 2052 2 720 5868 t
( bitblt-style raster graphics by extending the notion of a bitmap to)11 3069(Instead, it supports general)3 1251 2 720 5988 t
(encompass rectangular regions which are subdivided into visible and invisible portions, and pro-)12 4320 1 720 6108 t
( between the simple, traditional bitmap operations and the more gen-)10 3169(vides an elegant interface)3 1151 2 720 6228 t
( is reduced to providing a user interface.)7 1788( role of the traditional ``window manager'')6 1893( The)1 218(eral ones.)1 421 4 720 6348 t
( in which to conve-)4 845(In [mey81] appears the sentence, ``Research needs to be done to develop a way)13 3475 2 720 6468 t
( window manager.'')2 908(niently store and manipulate graphics data in the context of a)10 2813 2 720 6588 t
10 CW f
(layerop\(\))4500 6588 w
10 PA f
(and its associated primitives meet this challenge.)6 2155 1 720 6708 t
cleartomark
showpage
saveobj restore
%%EndPage: 22 24
%%Page: 23 25
/saveobj save def
mark
25 pagesetup
10 PA f
(- 23 -)2 216 1 2772 480 t
10 PB f
(Acknowledgements)720 840 w
10 PA f
( grew)1 268( data structures)2 716( The)1 232(Many people helped develop the algorithms discussed herein.)7 2854 4 970 996 t
( Doug McIlroy guided me through the mazes of integer)9 2526(out of discussions with Ken Thompson;)5 1794 2 720 1116 t
( theorems straight; Andrew Koenig simplified)5 2088(geometry; Peter Weinberger got my line-drawing)5 2232 2 720 1236 t
( details of)2 462(the Bitmap data structure; Andrew Hume spent a difficult week getting the)11 3517 2 720 1356 t
10 CW f
(lbit-)4740 1356 w
(blt\(\))720 1476 w
10 PA f
( Reiser wrote an astonishing implementation of)6 2209(right; John)1 488 2 1063 1476 t
10 CW f
(bitblt\(\))3804 1476 w
10 PA f
(, on which it all)4 756 1 4284 1476 t
( Dave MacQueen and Chris van Wyk made helpful constructive)9 2910(depends; and Brian Kernighan,)3 1410 2 720 1596 t
( to rethink and rewrite large portions of the soft-)9 2206(criticism on an early manuscript, which led me)7 2114 2 720 1716 t
( am most deeply indebted, however, to Bart Locan-)8 2286( I)1 87( thank them all.)3 699( I)1 87(ware as well as the paper.)5 1161 5 720 1836 t
(thi, who wrote the first)4 1088 1 720 1956 t
10 CW f
(bitblt\(\))1851 1956 w
10 PA f
( to)1 132(, greatly improved the interface)4 1468 2 2331 1956 t
10 CW f
(layerop\(\))3975 1956 w
10 PA f
(, and, most)2 525 1 4515 1956 t
( bitmap terminal and placed it on my desk, thereby challenging)10 2885(important, designed and built a)4 1435 2 720 2076 t
(me to tame the bitmap world.)5 1315 1 720 2196 t
10 PB f
(References)720 2436 w
10 PA f
( a digital plotter,'')3 806( J. E., ``Algorithm for computer control of)7 1852([bre65] Bresenham,)1 1018 3 720 2712 t
10 PI f
(IBM Syst. J.,)2 534 1 4426 2712 t
10 PB f
(4)4990 2712 w
10 PA f
(\(1\):25-30, 1965)1 624 1 720 2832 t
( Language for Bitmap Manipulation,'')4 1751( L. J. and J. Stolfi, ``A)6 1020([gui82] Guibas,)1 837 3 720 2952 t
10 PI f
(Transactions on)1 668 1 4372 2952 t
(Graphics,)720 3072 w
10 PB f
(1)1133 3072 w
10 PA f
(\(3\): 191, July 1982.)3 794 1 1208 3072 t
( D. H. H., ``The Smalltalk Graphics Kernel,'')7 1934([ing81] Ingalls,)1 823 2 720 3192 t
10 PI f
(Byte,)3502 3192 w
10 PB f
(6)3735 3192 w
10 PA f
(\(8\): 168, August 1981.)3 945 1 3810 3192 t
( R. Rashid, ``Virtual Terminal Management in a Multiple Process Environ-)10 3371([lan79] Lantz, K. and)3 949 2 720 3312 t
(ment,'')720 3432 w
10 PI f
(Proceedings of the 7th Symposium on Operating Systems Principles,)8 2777 1 1053 3432 t
10 PA f
(p. 86, December 1979.)3 958 1 3855 3432 t
( Mosher, ``BRUWIN: An Adaptable Design Strategy for Win-)8 2798( N. and M.)3 508([mey81] Meyrowitz,)1 1014 3 720 3552 t
(dow Manager/Virtual Terminal Systems,'')3 1915 1 720 3672 t
10 PI f
( Operating Systems)2 815(Proceedings of the 8th Symposium on)5 1557 2 2668 3672 t
(Principles,)720 3792 w
10 PB f
(15)1179 3792 w
10 PA f
(\(5\): 180, December 1981.)3 1064 1 1304 3792 t
( W. M., and R. F. Sproull,)6 1143([new79] Newman,)1 935 2 720 3912 t
10 PI f
( Interactive Computer Graphics, 2nd Ed.,)5 1701(Principles of)1 511 2 2828 3912 t
10 PA f
(McGraw Hill, New York, 1979)4 1340 1 720 4032 t
( Larry, ``The Smalltalk Environment,'')4 1677([tes81] Tesler,)1 793 2 720 4152 t
10 PI f
(Byte,)3215 4152 w
10 PB f
(6)3448 4152 w
10 PA f
(\(8\): 90, August 1981.)3 895 1 3523 4152 t
( D. Moon, ``Introduction to Using the Window System,'' Symbolics, Inc.)10 3230([wei81] Weinreb, D. and)3 1090 2 720 4272 t
(1981.)720 4392 w
cleartomark
showpage
saveobj restore
%%EndPage: 23 25
%%Trailer
done
%%Pages: 25
%%DocumentFonts: Courier Palatino-Roman Palatino-Bold Times-Italic Palatino-Italic Times-Roman Symbol Times-Roman
%%+ Helvetica-Bold
